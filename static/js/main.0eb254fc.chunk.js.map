{"version":3,"sources":["reportWebVitals.ts","store.ts","worker.ts","components/LoadSampleBtn.tsx","utils.ts","components/LinePlot.tsx","components/Brush.tsx","components/Plot.tsx","components/DataDescription.tsx","components/Spinner.tsx","components/CalculateBtn.tsx","App.tsx","index.tsx"],"names":["reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","DataState","CalcState","worker","wrap","Worker","yValue","o","value","useStore","create","set","get","windowSize","dataState","Empty","calcState","setData","data","loadSampleData","a","csv","row","SampleData","calculate","Loading","undefined","x","Float32Array","from","map","profileIdxs","profile","Finished","selector","LoadSampleBtn","className","onClick","disabled","clamp","min","max","LinePlot","forwardRef","cursorRef","y","yOffset","yLength","margins","height","width","children","limits","title","refB","windowSizeB","brushClassName","showYAxis","cursorBrush","innerHeight","top","bottom","innerWidth","left","right","useMemo","length","yShow","slice","domain","range","xScale","scaleLinear","xAxis","axisBottom","tickSize","tickSizeOuter","extent","yScale","nice","yAxis","axisLeft","ticks","path","line","i","xAxisRef","useCallback","node","select","call","yAxisRef","transition","scaleWindowSize","Math","abs","scaleWindowSizeB","onCursorMove","clientX","target","ref","current","getBoundingClientRect","newX","newWidth","setAttribute","newWidthB","onCursorLeave","transform","fill","d","onPointerMove","onPointerLeave","Brush","setLimits","brushEnd","selection","type","invert","brush","brushX","on","refTS","useRef","refMP","yScaleMP","pathMP","useEffect","brushMargins","plotLimits","brushLimits","Plot","useMeasure","polyfill","ResizeObserver","useState","plotData","dataHeight","brushHeight","cursorRefTS","cursorRefMP","style","minWidth","props","DataDescription","href","rel","sizes","Spinner","size","sz","sizeCls","viewBox","cx","cy","r","stroke","strokeWidth","CalculateBtn","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.0eb254fc.chunk.js","sourcesContent":["import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import { csv } from \"d3\";\nimport create from \"zustand\";\nimport { wrap } from \"comlink\";\n// eslint-disable-next-line import/no-webpack-loader-syntax\nimport Worker from \"worker-loader!./worker\";\nimport { TWorker } from \"./worker\";\n\nconst worker = wrap<TWorker>(new Worker());\n\nexport enum DataState {\n  Empty,\n  SampleData,\n  CustomData,\n}\n\nexport enum CalcState {\n  Empty,\n  Loading,\n  Finished,\n}\n\nexport type TData = {\n  value: number;\n}[];\n\nexport const yValue = (o: TData[0]) => o.value;\n\nexport type TStore = {\n  windowSize: number;\n  data?: TData;\n  dataState: DataState;\n  calcState: CalcState;\n  profile?: number[];\n  profileIdxs?: number[];\n  setData: (data: TData) => void;\n  loadSampleData: () => void;\n  calculate: () => void;\n};\n\nexport const useStore = create<TStore>((set, get) => ({\n  windowSize: 50,\n  dataState: DataState.Empty,\n  calcState: CalcState.Empty,\n  setData: (data) => set({ data }),\n  loadSampleData: async () => {\n    const data = await csv(\"accident_UK.csv\", (row: any) => ({\n      value: +row[\"Total_Accident\"],\n    }));\n    set({ data, dataState: DataState.SampleData });\n  },\n  calculate: async () => {\n    set({ calcState: CalcState.Loading });\n    const data = get().data;\n    if (data === undefined) return;\n    const x = Float32Array.from(data.map(yValue));\n    const { profileIdxs, profile } = await worker.calculate(\n      x,\n      get().windowSize\n    );\n    set({ profileIdxs, profile, calcState: CalcState.Finished });\n  },\n}));\n","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/worker.6b4c3841.worker.js\");\n}\n","import React from \"react\";\nimport { DataState, TStore, useStore } from \"../store\";\n\nconst selector = ({ loadSampleData, dataState }: TStore) => ({\n  loadSampleData,\n  dataState,\n});\n\nexport const LoadSampleBtn: React.FC = () => {\n  const { loadSampleData, dataState } = useStore(selector);\n\n  return (\n    <button\n      className=\"btn\"\n      onClick={loadSampleData}\n      disabled={dataState === DataState.SampleData}\n    >\n      Load sample\n    </button>\n  );\n};\n","export const clamp = (x: number, min: number, max: number) => {\n  return x < min ? min : x > max ? max : x;\n};\n\nexport const sleep = (delay: number) => new Promise((resolve) => setTimeout(resolve, delay));","import { axisBottom, axisLeft, extent, line, scaleLinear, select } from \"d3\";\nimport React, {\n  forwardRef,\n  ReactNode,\n  RefObject,\n  useCallback,\n  useMemo,\n} from \"react\";\nimport { Margins } from \"../types\";\n\ninterface Props {\n  y: number[];\n  yLength?: number;\n  height: number;\n  width: number;\n  margins: Margins;\n  limits: number[] | null;\n  title?: string;\n  className: string;\n  showYAxis?: boolean;\n  cursorBrush?: boolean;\n  children?: ReactNode;\n  refB?: RefObject<SVGRectElement>;\n  windowSize?: number;\n  windowSizeB?: number;\n  brushClassName?: string;\n}\n\nexport const LinePlot = forwardRef<SVGRectElement, Props>(\n  (\n    {\n      y,\n      yLength: yOffset,\n      margins,\n      height,\n      width,\n      children,\n      limits,\n      title,\n      className,\n      refB,\n      windowSize,\n      windowSizeB,\n      brushClassName,\n      showYAxis = true,\n      cursorBrush = false,\n    },\n    cursorRef\n  ) => {\n    const innerHeight = height - margins.top - margins.bottom;\n    const innerWidth = width - margins.left - margins.right;\n\n    const { x, yShow } = useMemo(() => {\n      return limits === null\n        ? { x: [0, yOffset ?? y.length ], yShow: y }\n        : { x: [limits[0], limits[1]], yShow: y.slice(limits[0], limits[1]) };\n    }, [limits, y, yOffset]);\n\n    const { xAxis, xScale } = useMemo(() => {\n      const domain = x;\n      const range = [margins.left, width - margins.right];\n      const xScale = scaleLinear().domain(domain).range(range);\n      const xAxis = axisBottom(xScale).tickSize(5).tickSizeOuter(0);\n      return { xAxis, xScale };\n    }, [margins.left, margins.right, width, x]);\n\n    const { yAxis, yScale } = useMemo(() => {\n      const domain = extent(y).map((o?: number) => o ?? 0);\n      const range = [height - margins.bottom, margins.top];\n      const yScale = scaleLinear().domain(domain).range(range).nice();\n      const yAxis = axisLeft(yScale).tickSize(-innerWidth).ticks(4);\n      return { yScale, yAxis };\n    }, [y, height, margins, innerWidth]);\n\n    const path = useMemo(() => {\n      if (yShow !== undefined) {\n        return line()(yShow.map((o, i) => [xScale(i + x[0]), yScale(o)]));\n      }\n      return null;\n    }, [yShow, xScale, yScale, x]);\n\n    const xAxisRef = useCallback(\n      (node) => {\n        select(node).call(xAxis);\n      },\n      [xAxis]\n    );\n\n    const yAxisRef = useCallback(\n      (node) => {\n        if (showYAxis) select(node).transition().call(yAxis);\n      },\n      [showYAxis, yAxis]\n    );\n\n    const scaleWindowSize = useMemo(\n      () => Math.abs(xScale(0) - xScale(windowSize ?? 0)),\n      [windowSize, xScale]\n    );\n\n    const scaleWindowSizeB = useMemo(\n      () => Math.abs(xScale(0) - xScale(windowSizeB ?? 0)),\n      [windowSizeB, xScale]\n    );\n\n    const onCursorMove = useCallback(\n      ({ clientX, target }) => {\n        const ref = cursorRef as React.RefObject<SVGRectElement>;\n        if (ref.current === null) return;\n        const { x, width } = target.getBoundingClientRect();\n        const newX = clientX - x;\n        const newWidth = Math.min(width - newX, scaleWindowSize);\n        ref.current.setAttribute(\"x\", \"\" + newX);\n        ref.current.setAttribute(\"width\", \"\" + newWidth);\n        if (refB === undefined || refB.current === null) return;\n        const newWidthB = Math.min(width - newX, scaleWindowSizeB);\n        refB.current.setAttribute(\"x\", \"\" + newX);\n        refB.current.setAttribute(\"width\", \"\" + newWidthB);\n      },\n      [cursorRef, refB, scaleWindowSize, scaleWindowSizeB]\n    );\n\n    const onCursorLeave = useCallback(() => {\n      const ref = cursorRef as React.RefObject<SVGRectElement>;\n      if (ref.current === null) return;\n      ref.current.setAttribute(\"width\", \"0\");\n      if (refB === undefined || refB.current === null) return;\n      refB.current.setAttribute(\"width\", \"0\");\n    }, [cursorRef, refB]);\n\n    return (\n      <div className=\"bg-indigo-50 rounded-sm\">\n        <svg height={height} width={width}>\n          <rect\n            className=\"fill-current text-white\"\n            transform={`translate(${margins.left},${margins.top})`}\n            width={innerWidth}\n            height={innerHeight}\n          />\n          {title !== undefined ? (\n            <text\n              className=\"text-current text-2xl\"\n              transform={`translate(${margins.left + 5}, ${margins.top - 10})`}\n            >\n              {title}\n            </text>\n          ) : null}\n          <g\n            ref={xAxisRef}\n            transform={`translate(0,${height - margins.bottom})`}\n          />\n          <g ref={yAxisRef} transform={`translate(${margins.left},0)`} />\n          {path !== null ? (\n            <path fill=\"none\" className={className} d={path} />\n          ) : null}\n          {children}\n          {cursorBrush ? (\n            <g transform={`translate(${margins.left},${margins.top})`}>\n              <rect\n                ref={cursorRef}\n                className={brushClassName}\n                height={innerHeight}\n              />\n              <rect\n                className=\"opacity-0\"\n                width={innerWidth}\n                height={innerHeight}\n                onPointerMove={onCursorMove}\n                onPointerLeave={onCursorLeave}\n              />\n            </g>\n          ) : null}\n        </svg>\n      </div>\n    );\n  }\n);\n","import { extent, line, scaleLinear } from \"d3\";\nimport { brushX } from \"d3-brush\";\nimport { select } from \"d3-selection\";\nimport React, { useCallback, useEffect, useMemo, useRef } from \"react\";\nimport { Margins } from \"../types\";\nimport { LinePlot } from \"./LinePlot\";\n\ninterface Props {\n  y: number[];\n  profile?: number[];\n  width: number;\n  height: number;\n  margins: Margins;\n  setLimits: (x: number[] | null) => void;\n}\n\nexport const Brush: React.FC<Props> = ({\n  y,\n  profile,\n  height,\n  width,\n  margins,\n  setLimits,\n}) => {\n  const xScale = useMemo(() => {\n    const domain = [0, y.length];\n    const range = [margins.left, width - margins.right];\n    const xScale = scaleLinear().domain(domain).range(range);\n    return xScale;\n  }, [y.length, margins.left, margins.right, width]);\n\n  const brushEnd = useCallback(\n    ({ selection, type }) => {\n      if (selection === null) {\n        setLimits(null);\n      } else if (type !== \"end\") {\n        setLimits(selection.map(xScale.invert));\n      }\n    },\n    [setLimits, xScale]\n  );\n\n  const brush = useMemo(() => {\n    const brush = brushX().extent([\n      [margins.left, margins.top],\n      [width - margins.right, height - margins.bottom],\n    ]);\n    brush.on(\"brush\", brushEnd);\n    brush.on(\"end\", brushEnd);\n    return brush;\n  }, [margins, width, height, brushEnd]);\n\n  const refTS = useRef<SVGGElement>(null);\n  const refMP = useRef<SVGGElement>(null);\n\n  const yScaleMP = useMemo(() => {\n    const domain = extent(profile ?? [0, 100]).map((o?: number) => o ?? 0);\n    const range = [height - margins.bottom, margins.top];\n    const yScale = scaleLinear().domain(domain).range(range).nice();\n    return yScale;\n  }, [height, margins, profile]);\n\n  const pathMP = useMemo(() => {\n    if (profile !== undefined) {\n      return line()(profile.map((o, i) => [xScale(i), yScaleMP(o)]));\n    }\n    return null;\n  }, [profile, xScale, yScaleMP]);\n\n  useEffect(() => {\n    if (brush === undefined || refTS.current === null) return;\n    select(refTS.current).call(brush);\n    if (refMP.current !== null) select(refMP.current).call(brush);\n    // if (y.length > initialLimit) g.call(brush.move, [0, initialLimit].map(xScale));\n  }, [brush, xScale, y.length, profile]);\n\n  return (\n    <div>\n      <LinePlot\n        y={y}\n        margins={margins}\n        height={height}\n        width={width}\n        limits={null}\n        className=\"stroke-current text-blue-900 stroke-2 text-opacity-80\"\n        showYAxis={false}\n      >\n        {pathMP !== null ? (\n          <path\n            fill=\"none\"\n            className=\"stroke-current text-red-900 stroke-2 text-opacity-80\"\n            d={pathMP}\n          />\n        ) : null}\n        <g ref={refTS} />\n      </LinePlot>\n    </div>\n  );\n};\n","import React, { useMemo, useRef, useState } from \"react\";\nimport useMeasure from \"react-use-measure\";\nimport { TStore, useStore, yValue } from \"../store\";\nimport { clamp } from \"../utils\";\nimport { Brush } from \"./Brush\";\nimport { LinePlot } from \"./LinePlot\";\n\nconst selector = ({ data, profile, windowSize }: TStore) => ({\n  data,\n  profile,\n  windowSize,\n});\n\nconst margins = {\n  left: 30,\n  right: 20,\n  top: 38,\n  bottom: 25,\n};\n\nconst brushMargins = {\n  ...margins,\n  top: 10,\n};\n\nconst plotLimits = { minHeight: 100, maxHeight: 200 };\nconst brushLimits = { minHeight: 50, maxHeight: 120 };\n\nexport const Plot = () => {\n  const [ref, { height, width }] = useMeasure({ polyfill: ResizeObserver });\n  const { data, profile, windowSize } = useStore(selector);\n  const [limits, setLimits] = useState<number[] | null>(null);\n  const plotData = useMemo(() => data?.map(yValue), [data]);\n\n  let dataHeight = profile === undefined ? height : height / 2;\n  dataHeight = clamp(dataHeight, plotLimits.minHeight, plotLimits.maxHeight);\n  const brushHeight = clamp(\n    height - dataHeight,\n    brushLimits.minHeight,\n    brushLimits.maxHeight\n  );\n\n  const cursorRefTS = useRef<SVGRectElement>(null);\n  const cursorRefMP = useRef<SVGRectElement>(null);\n\n  return (\n    <div\n      ref={ref}\n      style={{ minWidth: \"300px\" }}\n      className=\"mt-4 flex flex-col flex-1\"\n    >\n      {plotData !== undefined ? (\n        <LinePlot\n          ref={cursorRefTS}\n          refB={cursorRefMP}\n          y={plotData}\n          margins={margins}\n          height={dataHeight}\n          width={width}\n          limits={limits}\n          title=\"Time series data\"\n          className=\"stroke-current text-blue-900 stroke-2 text-opacity-80\"\n          cursorBrush\n          brushClassName=\"fill-current text-blue-400 opacity-30\"\n          windowSize={windowSize}\n          windowSizeB={1}\n        />\n      ) : (\n        <div className=\"mt-5 text-center\">\n          <p>Upload some time series data or Load the sample data.</p>\n        </div>\n      )}\n      {profile !== undefined ? (\n        <div className=\"mt-2\">\n          <LinePlot\n            ref={cursorRefMP}\n            refB={cursorRefTS}\n            y={profile}\n            yLength={plotData?.length}\n            margins={margins}\n            height={dataHeight}\n            width={width}\n            limits={limits}\n            title=\"Matrix profile\"\n            className=\"stroke-current text-red-900 stroke-2 text-opacity-80\"\n            cursorBrush\n            brushClassName=\"fill-current text-red-600 opacity-60 stroke-current stroke-1\"\n            windowSize={1}\n            windowSizeB={windowSize}\n          />\n        </div>\n      ) : null}\n      {plotData !== undefined ? (\n        <div className=\"mt-2\">\n          <Brush\n            y={plotData}\n            profile={profile}\n            margins={brushMargins}\n            height={brushHeight}\n            width={width}\n            setLimits={setLimits}\n          />\n        </div>\n      ) : null}\n      {profile === undefined && plotData !== undefined ? (\n        <div className=\"mt-5 text-center\">\n          <p>Use the \"Calculate\" button to cumpute the matrix profile.</p>\n        </div>\n      ) : null}\n    </div>\n  );\n};\n","import React from \"react\";\nimport { DataState, TStore, useStore } from \"../store\";\n\nconst selector = (props: TStore) => props.dataState;\n\nexport const DataDescription: React.FC = () => {\n  const dataState = useStore(selector);\n\n  return dataState === DataState.SampleData ? (\n    <div className=\"mt-2 text-base text-gray-700\">\n      <p>\n        Data:{\" \"}\n        <a\n          href=\"https://www.kaggle.com/sadeghjalalian/road-accident-in-uk\"\n          target=\"_black\"\n          rel=\"noopener\"\n        >\n          Road Accident in UK\n        </a>\n      </p>\n      <p className=\"font-light\">\n        This data provides detailed road safety data about the circumstances of\n        personal injury road accidents in GB from 2014 to 2017. The statistics\n        relate only to personal injury accidents on public roads that are\n        reported to the police, and subsequently recorded, using the STATS19\n        accident reporting form.\n      </p>\n    </div>\n  ) : null;\n};\n","import React from \"react\";\n\nconst sizes = {\n  \"sm\": 3, \"md\": 4, \"lg\": 5\n}\n\ninterface Props {\n  className?: string;\n  size?: keyof typeof sizes;\n}\n\nexport const Spinner: React.FC<Props> = ({ className, size=\"md\" }) => {\n  const sz = sizes[size];\n  const sizeCls = `h-${sz} w-${sz}`;\n\n  return (\n    <svg className={`animate-spin ${sizeCls} ${className}`} fill=\"none\" viewBox=\"0 0 24 24\">\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n};\n","import React from \"react\";\nimport { CalcState, DataState, TStore, useStore } from \"../store\";\nimport { Spinner } from \"./Spinner\";\n\nconst selector = ({ dataState, calcState, calculate }: TStore) => ({\n  dataState,\n  calcState,\n  calculate,\n});\n\nexport const CalculateBtn: React.FC = () => {\n  const { dataState, calcState, calculate } = useStore(selector);\n\n  return (\n    <div>\n      <button\n        className=\"btn\"\n        onClick={calculate}\n        disabled={\n          dataState === DataState.Empty || calcState !== CalcState.Empty\n        }\n      >\n        <div className=\"flex items-baseline\">\n          Calculate\n          {calcState === CalcState.Loading ? (\n            <Spinner className=\"ml-1\" />\n          ) : null}\n        </div>\n      </button>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { LoadSampleBtn } from \"./components/LoadSampleBtn\";\nimport { Plot } from \"./components/Plot\";\nimport { DataDescription } from \"./components/DataDescription\";\nimport { CalculateBtn } from \"./components/CalculateBtn\";\n\nexport const App = () => {\n  return (\n    <div className=\"flex flex-col container mx-auto px-10 pt-6 min-h-screen\">\n      <p className=\"text-5xl font-bold\">Matrix Profile</p>\n      <div className=\"mt-14 pr-4 flex space-x-2 justify-end\">\n        {/* <p>upload data button</p> */}\n        {/* <p>info for uploading</p> */}\n        <LoadSampleBtn />\n        <CalculateBtn />\n      </div>\n      <DataDescription />\n      <Plot />\n    </div>\n  );\n};\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { App } from \"./App\";\nimport \"./index.css\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}