{"version":3,"sources":["reportWebVitals.ts","utils.ts","store.ts","wasm.worker.ts","components/LoadSampleBtn.tsx","components/LinePlot.tsx","components/Brush.tsx","components/ColumnSelector.tsx","components/DownloadCSV.tsx","components/Plot.tsx","components/DataDescription.tsx","components/Spinner.tsx","components/CalculateBtn.tsx","components/WindowSizeSel.tsx","components/UploadBtn.tsx","components/RepoDescription.tsx","App.tsx","index.tsx"],"names":["reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","DataState","CalcState","clamp","x","min","max","worker","wrap","Worker","yValue","o","value","emptyCalc","lastWindowSize","undefined","calcState","Empty","profile","profileIdxs","discords","motifs","emptyCsvData","filename","csvData","csvColumns","selectedColumn","useStore","create","set","get","windowSize","dataState","setData","data","setWindowSize","selectColumn","column","Error","map","row","nRows","length","CustomData","loadSampleData","a","csv","SampleData","uploadData","path","strip_suffix","s","split","extractFilename","csvParse","columns","SelectColumn","calculate","Loading","Float32Array","from","Finished","calculateDiscords","calculateMotifs","getNearestNeighbour","idx","pIdxs","Math","round","brushPosition","nearestNeighbourPosition","setBrushPosition","floor","discordThreshold","th","quantile","i","filter","motifThreshold","selector","LoadSampleBtn","disabled","useMemo","className","onClick","formatNumber","format","LinePlot","y","yLength","margins","height","width","limits","title","brushNearestStyle","brushClassName","brushNearestClassName","showYAxis","cursorBrush","children","innerHeight","top","bottom","innerWidth","left","right","yShow","slice","domain","range","xScale","scaleLinear","xAxis","axisBottom","tickSize","tickSizeOuter","extent","yScale","nice","yAxis","axisLeft","tickPadding","ticks","tickFormat","line","xAxisRef","useCallback","node","select","call","yAxisRef","transition","cursorRef","useRef","scaleWindowSize","abs","brushXPosition","brushWindowSize","xPosition","brushNearestXPosition","leftCap","brushNearestWindowSize","onCursorMove","clientX","target","current","getBoundingClientRect","newX","invert","transform","ref","fill","d","style","onPointerMove","Brush","setLimits","brushEnd","selection","type","brush","brushX","on","yScaleMP","pathMP","useEffect","fillOpacity","ColumnSelector","onChange","col","DownloadCSV","useState","setCsv","downloadFilename","join","brushMargins","plotLimits","brushLimits","Plot","useMeasure","polyfill","ResizeObserver","plotData","dataHeight","brushHeight","showWindowSize","minWidth","DataDescription","fn","href","rel","sizes","sm","md","lg","Spinner","size","sz","viewBox","cx","cy","r","stroke","strokeWidth","CalculateBtn","notWindowChanged","stateReady","WindowSizeSel","step","defaultValue","UploadBtn","reader","fr","FileReader","onload","result","files","readAsText","click","accept","RepoDescription","props","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"kMAceA,EAZS,SAACC,GACnBA,GAAeA,aAAuBC,UACxC,8BAAqBC,MAAK,YAAkD,IAA/CC,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAON,GACPO,EAAQP,O,8DCTP,ICUKQ,EAQAC,EDlBCC,EAAQ,SAACC,EAAWC,EAAaC,GAC5C,OAAOF,EAAIC,EAAMA,EAAMD,EAAIE,EAAMA,EAAMF,GCOnCG,EAASC,YAAc,ICRd,WACb,OAAO,IAAIC,OAAO,IAA0B,+C,SDSlCR,O,iBAAAA,I,2BAAAA,I,+BAAAA,I,2BAAAA,I,kBAAAA,M,cAQAC,O,iBAAAA,I,qBAAAA,I,wBAAAA,M,KAUL,IAAMQ,EAAS,SAACC,GAAD,OAAiBA,EAAEC,OAEnCC,EAAY,CAChBC,oBAAgBC,EAChBC,UAAWd,EAAUe,MACrBC,aAASH,EACTI,iBAAaJ,EACbK,SAAU,GACVC,OAAQ,IAGJC,EAAe,CACnBC,cAAUR,EACVS,aAAST,EACTU,gBAAYV,EACZW,oBAAgBX,GAgDLY,EAAWC,aAAe,SAACC,EAAKC,GAAN,MAAe,CACpDC,WAAY,GACZC,UAAW/B,EAAUgB,MACrBD,UAAWd,EAAUe,MACrBgB,QAAS,SAACC,GAAD,OAAUL,EAAI,CAAEK,UACzBC,cAAe,SAACJ,GAAD,OAAgBF,EAAI,CAAEE,gBACrCK,aAAc,SAACC,GACbR,GAAI,YAAkB,IAAfL,EAAc,EAAdA,QACL,QAAgBT,IAAZS,EAAuB,MAAO,CAAEQ,UAAW/B,EAAUqC,OACzD,IAAMJ,EAAOV,EAAQe,KAAI,SAACC,GAAD,YAAU,CAAE5B,QAAO,UAAE4B,EAAIH,UAAN,QAAiB,QAC7D,MAAO,CACLH,OACAO,MAAOP,EAAKQ,OACZhB,eAAgBW,EAChBL,UAAW/B,EAAU0C,gBAI3BC,eAAe,WAAD,4BAAE,4BAAAC,EAAA,sEACKC,YAAI,mBAAmB,SAACN,GAAD,MAAe,CACvD5B,OAAQ4B,EAAG,mBAFC,OACRN,EADQ,OAIdL,EAAI,yBACFK,OACAO,MAAOP,EAAKQ,OACZV,UAAW/B,EAAU8C,YAClBlC,GACAS,IATS,2CAAF,kDAAC,GAYf0B,WAAY,SAACd,EAAMe,GACjB,IAAM1B,OAAoBR,IAATkC,EAAqB,GDnHX,SAACA,GAAwC,IAA1BC,EAAyB,wDAC/DC,EAAIF,EAAKG,MAAM,MACjB7B,EAAW4B,EAAEA,EAAET,OAAS,GAE5B,OADIQ,IAAc3B,EAAWA,EAAS6B,MAAM,QAAQ,IAC7C7B,EC+GsC8B,CAAgBJ,GACrDzB,EAAU8B,YAASpB,GACnBT,EAAaD,EAAQ+B,QAC3B1B,EAAI,aACFN,WACAC,UACAC,aACAS,UAAMnB,EACN0B,WAAO1B,EACPiB,UAAW/B,EAAUuD,aACrB9B,oBAAgBX,GACbF,IAELiB,IAAMM,aAAaX,EAAW,KAEhCgC,UAAU,WAAD,4BAAE,sCAAAZ,EAAA,yDACThB,EAAI,CAAEb,UAAWd,EAAUwD,eAEd3C,KADPmB,EAAOJ,IAAMI,MAFV,wDAIHH,EAAaD,IAAMC,WACnB3B,EAAIuD,aAAaC,KAAK1B,EAAKK,IAAI7B,IAL5B,SAM8BH,EAAOkD,UAAUrD,EAAG2B,GANlD,gBAMDZ,EANC,EAMDA,YAAaD,EANZ,EAMYA,QACrBW,EAAI,CACFV,cACAD,UACAF,UAAWd,EAAU2D,SACrB/C,eAAgBiB,IAElBD,IAAMgC,oBACNhC,IAAMiC,kBAdG,4CAAF,kDAAC,GAgBVC,oBAAqB,SAACC,GAAS,IAAD,EACtBC,EAAQpC,IAAMX,YACpB,YAAcJ,IAAVmD,GAA6B,EACjC,UAAOA,EAAMC,KAAKC,MAAMH,WAAxB,SAAkC,GAEpCI,eAAgB,EAChBC,0BAA2B,EAC3BC,iBAAkB,SAACnE,GACjB,OAAOyB,GAAI,YAAqC,IAAlCmC,EAAiC,EAAjCA,oBAAqBvB,EAAY,EAAZA,MAC3B4B,EAAgBlE,EAAMgE,KAAKK,MAAMpE,GAAI,GAAG,OAACqC,QAAD,IAACA,IAAS,GAAK,GAC7D,MAAO,CACL4B,gBACAC,yBAA0BN,EAAoBK,QAIpDI,iBAAkB,IAClBrD,SAAU,GACV0C,kBAAmB,WACjBjC,GAAI,YAAoC,IAAjCX,EAAgC,EAAhCA,QAASuD,EAAuB,EAAvBA,iBACd,QAAgB1D,IAAZG,EAAuB,MAAO,CAAEE,SAAU,IAC9C,IAAMsD,EAAKC,YAASzD,EAASuD,GAQ7B,MAAO,CAAErD,cANAL,IAAP2D,EACI,GACAxD,EACGqB,KAAI,SAACnC,EAAGwE,GAAJ,MAAU,CAACxE,EAAGwE,MAClBC,QAAO,wCAAcH,KACrBnC,KAAI,4DAIjBuC,eAAgB,IAChBzD,OAAQ,GACR0C,gBAAiB,WACflC,GAAI,YAAkC,IAA/BX,EAA8B,EAA9BA,QAAS4D,EAAqB,EAArBA,eACd,QAAgB/D,IAAZG,EAAuB,MAAO,CAAEG,OAAQ,IAC5C,IAAMqD,EAAKC,YAASzD,EAAS4D,GAQ7B,MAAO,CAAEzD,YANAN,IAAP2D,EACI,GACAxD,EACGqB,KAAI,SAACnC,EAAGwE,GAAJ,MAAU,CAACxE,EAAGwE,MAClBC,QAAO,wCAAcH,KACrBnC,KAAI,gE,OElMbwC,EAAW,SAAC,GAAD,MAAuD,CACtEnC,eADe,EAAGA,eAElBZ,UAFe,EAAmBA,UAGlChB,UAHe,EAA8BA,YAMlCgE,EAA0B,WAAO,IAAD,EACMrD,EAASoD,GAAlDnC,EADmC,EACnCA,eAAgBZ,EADmB,EACnBA,UAAWhB,EADQ,EACRA,UAE7BiE,EAAWC,mBAAQ,WACvB,OACElD,IAAc/B,EAAU8C,YAAc/B,IAAcd,EAAUwD,UAE/D,CAAC1C,EAAWgB,IAEf,OACE,wBAAQmD,UAAU,MAAMC,QAASxC,EAAgBqC,SAAUA,EAA3D,0B,wBCmBEF,EAAW,SAAC,GAAD,MAIF,CACbV,cALe,EACfA,cAKAE,iBANe,EAEfA,iBAKAD,yBAPe,EAGfA,2BAOIe,EAAeC,YAAO,OAEfC,EAA4B,SAAC,GAgBnC,IAfLC,EAeI,EAfJA,EACAC,EAcI,EAdJA,QACAC,EAaI,EAbJA,QACAC,EAYI,EAZJA,OACAC,EAWI,EAXJA,MACAC,EAUI,EAVJA,OACAC,EASI,EATJA,MACAX,EAQI,EARJA,UACAY,EAOI,EAPJA,kBACAhE,EAMI,EANJA,WACAiE,EAKI,EALJA,eACAC,EAII,EAJJA,sBAII,IAHJC,iBAGI,aAFJC,mBAEI,SADJC,EACI,EADJA,SAEMC,EAAcV,EAASD,EAAQY,IAAMZ,EAAQa,OAC7CC,EAAaZ,EAAQF,EAAQe,KAAOf,EAAQgB,MAF9C,EAIiBxB,mBAAQ,WAC3B,OAAkB,OAAXW,EACH,CAAEzF,EAAG,CAAC,EAAD,OAAIqF,QAAJ,IAAIA,IAAWD,EAAE9C,QAASiE,MAAOnB,GACtC,CAAEpF,EAAG,CAACyF,EAAO,GAAIA,EAAO,IAAKc,MAAOnB,EAAEoB,MAAMf,EAAO,GAAIA,EAAO,OACjE,CAACA,EAAQL,EAAGC,IAJPrF,EAJJ,EAIIA,EAAGuG,EAJP,EAIOA,MAJP,EAUsBzB,mBAAQ,WAChC,IAAM2B,EAASzG,EACT0G,EAAQ,CAACpB,EAAQe,KAAMb,EAAQF,EAAQgB,OACvCK,EAASC,cAAcH,OAAOA,GAAQC,MAAMA,GAElD,MAAO,CAAEG,MADKC,YAAWH,GAAQI,SAAS,GAAGC,cAAc,GAC3CL,YACf,CAACrB,EAAQe,KAAMf,EAAQgB,MAAOd,EAAOxF,IANhC6G,EAVJ,EAUIA,MAAOF,EAVX,EAUWA,OAVX,EAkBsB7B,mBAAQ,WAChC,IAAM2B,EAASQ,YAAO7B,GAAGjD,KAAI,SAAC5B,GAAD,cAAgBA,QAAhB,IAAgBA,IAAK,KAC5CmG,EAAQ,CAACnB,EAASD,EAAQa,OAAQb,EAAQY,KAC1CgB,EAASN,cAAcH,OAAOA,GAAQC,MAAMA,GAAOS,OAOzD,MAAO,CAAED,SAAQE,MANHC,YAASH,GACpBH,UAAUX,GACVkB,YAAY,GACZC,MAAM,GACNC,WAAWvC,MAGb,CAACG,EAAGG,EAAQD,EAASc,IAXhBgB,EAlBJ,EAkBIA,MAAOF,EAlBX,EAkBWA,OAaTrE,EAAOiC,mBAAQ,WACnB,YAAcnE,IAAV4F,EACKkB,cAAOlB,EAAMpE,KAAI,SAAC5B,EAAGiE,GAAJ,MAAU,CAACmC,EAAOnC,EAAIxE,EAAE,IAAKkH,EAAO3G,QAEvD,OACN,CAACgG,EAAOI,EAAQO,EAAQlH,IAErB0H,EAAWC,uBACf,SAACC,GACCC,YAAOD,GAAME,KAAKjB,KAEpB,CAACA,IAGGkB,EAAWJ,uBACf,SAACC,GACK9B,GAAW+B,YAAOD,GAAMI,aAAaF,KAAKV,KAEhD,CAACtB,EAAWsB,IAERa,EAAYC,iBAAuB,MAEnCC,EAAkBrD,mBACtB,kBACiB,IAAfnD,EAAmB,EAAIoC,KAAKqE,IAAIzB,EAAO,GAAKA,EAAM,OAAChF,QAAD,IAACA,IAAc,MACnE,CAACA,EAAYgF,IAxDX,EA+DApF,EAASoD,GAHXV,EA5DE,EA4DFA,cACAE,EA7DE,EA6DFA,iBACAD,EA9DE,EA8DFA,yBA9DE,EAiEwCY,mBAAQ,WAClD,IAAMuD,EAAiB1B,EAAO1C,GAAiBqB,EAAQe,KAKvD,MAAO,CAAEgC,iBAAgBC,iBAHJ,IAAnBrE,EACI,EACAF,KAAK9D,IAAImG,EAAaiC,EAAgBF,MAE3C,CAAClE,EAAemC,EAAYd,EAAQe,KAAM8B,EAAiBxB,IAPtD0B,EAjEJ,EAiEIA,eAAgBC,EAjEpB,EAiEoBA,gBAjEpB,EA0EsDxD,mBAAQ,WAChE,IAAMyD,EAAY5B,EAAOzC,GAA4BoB,EAAQe,KACvDmC,EAAwBzE,KAAK7D,IAAI,EAAGqI,GACpCE,EAAUF,EAAYJ,EAS5B,MAAO,CAAEK,wBAAuBE,wBAPf,IAAfH,GAAoBE,EAAUnD,EAAQe,KAClC,EACAtC,KAAK9D,IACHwI,EACAN,EACA/B,EAAaoC,MAGpB,CACDpC,EACAd,EAAQe,KACRnC,EACAiE,EACAxB,IAlBM6B,EA1EJ,EA0EIA,sBAAuBE,EA1E3B,EA0E2BA,uBAqBzBC,EAAehB,uBACnB,YAA0B,IAAvBiB,EAAsB,EAAtBA,QAASC,EAAa,EAAbA,OAEV,GAAoB,OADRZ,EACJa,QAAR,CAFuB,IAGf9I,EAAM6I,EAAOE,wBAAb/I,EACFgJ,EAAOJ,EAAU7E,KAAKC,MAAMhE,GAClCmE,EAAiBwC,EAAOsC,OAAOD,EAAO1D,EAAQe,KAAO,OAEvD,CAACf,EAAQe,KAAMlC,EAAkBwC,IAGnC,OACE,qBAAK5B,UAAU,0BAAf,SACE,sBAAKQ,OAAQA,EAAQC,MAAOA,EAA5B,UACE,sBACET,UAAU,0BACVmE,UAAS,oBAAe5D,EAAQe,KAAvB,YAA+Bf,EAAQY,IAAvC,KACTV,MAAOY,EACPb,OAAQU,SAECtF,IAAV+E,EACC,sBACEX,UAAU,wBACVmE,UAAS,oBAAe5D,EAAQe,KAAO,EAA9B,aAAoCf,EAAQY,IAAM,GAAlD,KAFX,SAIGR,IAED,KACJ,mBACEyD,IAAKzB,EACLwB,UAAS,sBAAiB3D,EAASD,EAAQa,OAAlC,OAEX,mBAAGgD,IAAKpB,EAAUmB,UAAS,oBAAe5D,EAAQe,KAAvB,SACjB,OAATxD,EACC,sBAAMuG,KAAK,OAAOrE,UAAWA,EAAWsE,EAAGxG,IACzC,KACJ,oBAAGqG,UAAS,oBAAe5D,EAAQe,KAAvB,YAA+Bf,EAAQY,IAAvC,KAAZ,UACE,sBACEnB,UAAWc,EACXyD,MAAO3D,EACPJ,OAAQU,EACRjG,EAAGwI,EACHhD,MAAOkD,IAER3C,EACC,qCACE,sBACEoD,IAAKlB,EACLlD,UAAWa,EACXL,OAAQU,EACRjG,EAAGqI,EACH7C,MAAO8C,IAET,sBACEvD,UAAU,YACVS,MAAOY,EACPb,OAAQU,EACRsD,cAAeZ,OAGjB,QAEL3C,QC9MIwD,EAAyB,SAAC,GAQhC,IAPLpE,EAOI,EAPJA,EACAtE,EAMI,EANJA,QACAyE,EAKI,EALJA,OACAC,EAII,EAJJA,MACAF,EAGI,EAHJA,QACA3D,EAEI,EAFJA,WACA8H,EACI,EADJA,UAEM9C,EAAS7B,mBAAQ,WACrB,IAAM2B,EAAS,CAAC,EAAGrB,EAAE9C,QACfoE,EAAQ,CAACpB,EAAQe,KAAMb,EAAQF,EAAQgB,OAE7C,OADeM,cAAcH,OAAOA,GAAQC,MAAMA,KAEjD,CAACtB,EAAE9C,OAAQgD,EAAQe,KAAMf,EAAQgB,MAAOd,IAErCkE,EAAW/B,uBACf,YAA0B,IAAvBgC,EAAsB,EAAtBA,UAAWC,EAAW,EAAXA,KACM,OAAdD,EACFF,EAAU,MACQ,QAATG,GACTH,EAAUE,EAAUxH,IAAIwE,EAAOsC,WAGnC,CAACQ,EAAW9C,IAGRkD,EAAQ/E,mBAAQ,WACpB,IAAM+E,EAAQC,cAAS7C,OAAO,CAC5B,CAAC3B,EAAQe,KAAMf,EAAQY,KACvB,CAACV,EAAQF,EAAQgB,MAAOf,EAASD,EAAQa,UAI3C,OAFA0D,EAAME,GAAG,QAASL,GAClBG,EAAME,GAAG,MAAOL,GACTG,IACN,CAACvE,EAASE,EAAOD,EAAQmE,IAEtBP,EAAMjB,iBAAoB,MAE1B8B,EAAWlF,mBAAQ,WACvB,IAAM2B,EAASQ,YAAM,OAACnG,QAAD,IAACA,IAAW,CAAC,EAAG,MAAMqB,KAAI,SAAC5B,GAAD,cAAgBA,QAAhB,IAAgBA,IAAK,KAC9DmG,EAAQ,CAACnB,EAASD,EAAQa,OAAQb,EAAQY,KAEhD,OADeU,cAAcH,OAAOA,GAAQC,MAAMA,GAAOS,SAExD,CAAC5B,EAAQD,EAASxE,IAEfmJ,EAASnF,mBAAQ,WACrB,YAAgBnE,IAAZG,EACK2G,cAAO3G,EAAQqB,KAAI,SAAC5B,EAAGiE,GAAJ,MAAU,CAACmC,EAAOnC,GAAIwF,EAASzJ,QAEpD,OACN,CAACO,EAAS6F,EAAQqD,IAOrB,OALAE,qBAAU,gBACMvJ,IAAVkJ,GAAuC,OAAhBV,EAAIL,SAC/BjB,YAAOsB,EAAIL,SAAShB,KAAK+B,KACxB,CAACA,EAAOlD,EAAQvB,EAAE9C,OAAQxB,IAG3B,qBAAKiE,UAAU,gBAAf,SACE,eAAC,EAAD,CACEK,EAAGA,EACHE,QAASA,EACTC,OAAQA,EACRC,MAAOA,EACPC,OAAQ,KACRV,UAAU,wDACVe,WAAW,EACXnE,WAAYA,EACZoE,aAAW,EACXH,eAAe,wCACfC,sBAAsB,gFACtBF,kBAAmB,CAAEwE,YAAa,IAZpC,UAcc,OAAXF,EACC,sBACEb,KAAK,OACLrE,UAAU,uDACVsE,EAAGY,IAEH,KACJ,mBAAGd,IAAKA,UC/FVxE,EAAW,SAAC,GAAD,MAA2C,CAC1DtD,WADe,EAAGA,WAElBW,aAFe,EAAeA,eAKnBoI,EAA2B,WAAO,IAAD,EACP7I,EAASoD,GAAtCtD,EADoC,EACpCA,WAAYW,EADwB,EACxBA,aAEdqI,EAAW1C,uBACf,YAAiB,IAAdkB,EAAa,EAAbA,OACD7G,EAAa6G,EAAOrI,SAEtB,CAACwB,IAGH,YAAsBrB,IAAfU,EACL,sBAAK0D,UAAU,OAAf,UACE,mBAAGA,UAAU,cAAb,4BACA,wBACEA,UAAU,sCACVsF,SAAUA,EAFZ,SAIGhJ,EAAWc,KAAI,SAACmI,EAAK9F,GAAN,OACd,wBAAgBhE,MAAO8J,EAAvB,SACGA,GADU9F,WAMjB,M,QC5BAG,EAAW,SAAC,GAAD,MAA+C,CAC9D7D,QADe,EAAGA,QAElBF,UAFe,EAAYA,UAG3BO,SAHe,EAAuBA,WAU3BoJ,EAA+B,SAAC,GAAmB,IAAjBxF,EAAgB,EAAhBA,UAAgB,EACpBxD,EAASoD,GAA1C7D,EADqD,EACrDA,QAASF,EAD4C,EAC5CA,UAAWO,EADiC,EACjCA,SADiC,EAEvCqJ,mBAAiB,IAFsB,mBAEtD9H,EAFsD,KAEjD+H,EAFiD,KAGvD5F,EAAWC,mBAAQ,kBAAMlE,IAAcd,EAAUwD,UAAS,CAAC1C,IAC3D8J,EAAmB5F,mBAAQ,WAC/B,YAAiBnE,IAAbQ,EAA+B,qBAC5BA,EAAS6B,MAAM,QAAQ,GAAK,iBAClC,CAAC7B,IAEE6D,EAAU2C,uBAAY,WAC1B,OAAI9C,IACJ4F,EAAO,oBAAqB,OAAC3J,QAAD,IAACA,IAAW,IAAI6J,KAAK,QAC1C,KACN,CAAC9F,EAAU/D,IAEd,OACE,cAAC,UAAD,CACEgB,KAAMY,EACNvB,SAAUuJ,EACV1F,QAASA,EACTD,UAAWA,EAJb,SAME,wBAAQA,UAAU,gBAAgBF,SAAUA,EAA5C,gCC3BAF,EAAW,SAAC,GAAD,MAOF,CACb7C,KARe,EACfA,KAQAhB,QATe,EAEfA,QAQAa,WAVe,EAGfA,WAQAjB,eAXe,EAIfA,eAQAkB,UAZe,EAKfA,UAQAhB,UAbe,EAMfA,YAUI0E,EAAU,CACde,KAAM,GACNC,MAAO,GACPJ,IAAK,GACLC,OAAQ,IAGJyE,EAAY,2BACbtF,GADa,IAEhBY,IAAK,KAGD2E,EAA0B,IAA1BA,EAA0C,IAC1CC,EAA2B,GAA3BA,EAA0C,IAEnCC,EAAO,WAAO,IAAD,EACSC,YAAW,CAAEC,SAAUC,iBADhC,mBACjB/B,EADiB,YACV5D,EADU,EACVA,OAAQC,EADE,EACFA,MADE,EASpBjE,EAASoD,GANX7C,EAHsB,EAGtBA,KACAhB,EAJsB,EAItBA,QACAa,EALsB,EAKtBA,WACAjB,EANsB,EAMtBA,eACAkB,EAPsB,EAOtBA,UACAhB,EARsB,EAQtBA,UARsB,EAUI4J,mBAA0B,MAV9B,mBAUjB/E,EAViB,KAUTgE,EAVS,KAWlB0B,EAAWrG,mBAAQ,yBAAMhD,QAAN,IAAMA,OAAN,EAAMA,EAAMK,IAAI7B,KAAS,CAACwB,IAX3B,EAYYgD,mBAAQ,WAC1C,IAAIsG,OAAyBzK,IAAZG,EAAwByE,EAASA,EAAS,EAO3D,MAAO,CAAE6F,WANTA,EAAarL,EAAMqL,EAAYP,EAAsBA,GAMhCQ,YALDtL,EAClBwF,EAAS6F,EACTN,EACAA,MAGD,CAACvF,EAAQzE,IATJsK,EAZgB,EAYhBA,WAAYC,EAZI,EAYJA,YAUdC,EAAiBxG,mBAAQ,WAC7B,OAAOlE,IAAcd,EAAUe,MAC3Bc,EADG,OAEHjB,QAFG,IAEHA,IAAkBiB,IACrB,CAACf,EAAWF,EAAgBiB,IAE/B,OACE,sBAAKwH,IAAKA,EAAKG,MAAO,CAAEiC,SAAU,SAAWxG,UAAU,qBAAvD,UACE,cAAC,EAAD,SACcpE,IAAbwK,EACC,qBAAKpG,UAAU,OAAf,SACE,cAAC,EAAD,CACEK,EAAG+F,EACH7F,QAASA,EACTC,OAAQ6F,EACR5F,MAAOA,EACPC,OAAQA,EACRC,MAAM,mBACNX,UAAU,wDACVgB,aAAW,EACXH,eAAe,wCACfC,sBAAsB,gFACtBF,kBAAmB,CAACwE,YAAa,IACjCxI,WAAY2J,MAGd1J,IAAc/B,EAAUuD,aAC1B,qBAAK2B,UAAU,mBAAf,SACE,6DAGF,qBAAKA,UAAU,mBAAf,SACE,6FAGSpE,IAAZG,EACC,qBAAKiE,UAAU,OAAf,SACE,cAAC,EAAD,CACEK,EAAGtE,EACHuE,QAAO,OAAE8F,QAAF,IAAEA,OAAF,EAAEA,EAAU7I,OACnBgD,QAASA,EACTC,OAAQ6F,EACR5F,MAAOA,EACPC,OAAQA,EACRC,MAAM,iBACNX,UAAU,uDACVgB,aAAW,EACXH,eAAe,+DACfC,sBAAsB,4EACtBlE,WAAY,MAGd,UACUhB,IAAbwK,EACC,qBAAKpG,UAAU,OAAf,SACE,cAAC,EAAD,CACEK,EAAG+F,EACHrK,QAASA,EACTwE,QAASsF,EACTrF,OAAQ8F,EACR7F,MAAOA,EACPiE,UAAWA,EACX9H,WAAY2J,MAGd,UACS3K,IAAZG,EACC,cAAC,EAAD,CAAaiE,UAAU,2BACRpE,IAAbwK,EACF,qBAAKpG,UAAU,mBAAf,SACE,4FAEA,S,QClIJJ,EAAW,SAAC,GAAD,MAA6C,CAC5DtC,MADe,EAAGA,MAElBT,UAFe,EAAUA,UAGzBT,SAHe,EAAqBA,WAMhC8D,EAAeC,YAAO,QAEfsG,EAA4B,WAAO,IAAD,EACNjK,EAASoD,GAAxCtC,EADqC,EACrCA,MAAOT,EAD8B,EAC9BA,UAAWT,EADmB,EACnBA,SAGpBsK,EAAE,OAAGtK,QAAH,IAAGA,IAAY,cAEvB,OAHES,IAAc/B,EAAU8C,YAAcf,IAAc/B,EAAU0C,WAI9D,sBAAKwC,UAAU,+BAAf,UACE,mBAAGA,UAAU,qBAAb,oBACCnD,IAAc/B,EAAU0C,WACvB,oBAAGwC,UAAU,SAAb,UACG0G,EAAI,SACM9K,IAAV0B,EACC,uBAAM0C,UAAU,UAAhB,cAA4BE,EAAa5C,GAAzC,YACE,QAGN,qCACE,mBAAG0C,UAAU,SAAb,SACE,mBACE2G,KAAK,4DACL7C,OAAO,SACP8C,IAAI,WAHN,mCAQF,mBAAG5G,UAAU,kBAAb,kUAUJ,MC/CA6G,EAAQ,CACZC,GAAI,UACJC,GAAI,UACJC,GAAI,WAQOC,EAA2B,SAAC,GAAgC,IAA9BjH,EAA6B,EAA7BA,UAA6B,IAAlBkH,KAC9CC,EAAKN,OAD2D,MAAX,KAAW,GAGtE,OACE,sBACE7G,UAAS,uBAAkBmH,EAAlB,YAAwBnH,GACjCqE,KAAK,OACL+C,QAAQ,YAHV,UAKE,wBACEpH,UAAU,aACVqH,GAAG,KACHC,GAAG,KACHC,EAAE,KACFC,OAAO,eACPC,YAAY,MAEd,sBACEzH,UAAU,aACVqE,KAAK,eACLC,EAAE,wHC7BJ1E,EAAW,SAAC,GAAD,MAMF,CACb/C,UAPe,EACfA,UAOAhB,UARe,EAEfA,UAOAe,WATe,EAGfA,WAOAjB,eAVe,EAIfA,eAOA2C,UAXe,EAKfA,YASWoJ,GAAyB,WAAO,IAAD,EAOtClL,EAASoD,GALX/C,EAFwC,EAExCA,UACAhB,EAHwC,EAGxCA,UACAe,EAJwC,EAIxCA,WACAjB,EALwC,EAKxCA,eACA2C,EANwC,EAMxCA,UAGIwB,EAAWC,mBAAQ,WACvB,IAAM4H,EAAmB/K,KAAU,OAAMjB,QAAN,IAAMA,IAAkBiB,GACrDgL,EACJ/K,IAAc/B,EAAUgB,OAASD,IAAcd,EAAUe,MAC3D,OAAO6L,GAAoBC,IAC1B,CAAC/L,EAAWgB,EAAWlB,EAAgBiB,IAE1C,OACE,wBAAQoD,UAAU,MAAMC,QAAS3B,EAAWwB,SAAUA,EAAtD,SACE,sBAAKE,UAAU,sBAAf,sBAEGnE,IAAcd,EAAUwD,QAAU,cAAC,EAAD,CAASyB,UAAU,SAAY,WCnCpEJ,GAAW,SAAC,GAAD,MAAuD,CACtEhD,WADe,EAAGA,WAElBf,UAFe,EAAeA,UAG9BmB,cAHe,EAA0BA,gBAM9B6K,GAA0B,WAAO,IAAD,EACMrL,EAASoD,IAAlDhD,EADmC,EACnCA,WAAYf,EADuB,EACvBA,UAAWmB,EADY,EACZA,cACzBsI,EAAW1C,uBACf,gBAAGkB,EAAH,EAAGA,OAAH,OAAgB9G,GAAe8G,EAAOrI,SACtC,CAACuB,IAGH,OACE,sBAAKgD,UAAU,sBAAf,UACE,mBAAGA,UAAU,cAAb,0BACA,uBACE6E,KAAK,SACL3J,IAAK,EACL4M,KAAM,EACNhI,SAAUjE,IAAcd,EAAUwD,QAClCwJ,aAAcnL,EACd0I,SAAUA,EACVtF,UAAU,kGCvBZJ,GAAW,SAAC,GAAD,MAAwC,CACvD/D,UADe,EAAGA,UAElBgC,WAFe,EAAcA,aAKlBmK,GAAsB,WAAO,IAAD,EACLxL,EAASoD,IAAnC/D,EAD+B,EAC/BA,UAAWgC,EADoB,EACpBA,WACbuG,EAAMjB,iBAAyB,MAC/BrD,EAAWC,mBAAQ,kBAAMlE,IAAcd,EAAUwD,UAAS,CAAC1C,IAE3DoM,EAASlI,mBAAQ,WACrB,IAAMmI,EAAK,IAAIC,WAMf,OALAD,EAAGE,OAAS,WAAO,IAAD,EACVtK,EAAI,UAAGsG,EAAIL,eAAP,aAAG,EAAatI,MAC1BoC,EAAWqK,EAAGG,OAAkBvK,GACZ,OAAhBsG,EAAIL,UAAkBK,EAAIL,QAAQtI,MAAQ,KAEzCyM,IACN,CAACrK,IAEEyH,EAAW1C,uBACf,YAAiB,IAAdkB,EAAa,EAAbA,OACoB,OAAjBA,EAAOwE,YACa1M,IAApBkI,EAAOwE,MAAM,IACjBL,EAAOM,WAAWzE,EAAOwE,MAAM,MAEjC,CAACL,IAGGhI,EAAU2C,uBAAY,WACN,OAAhBwB,EAAIL,SAAkBK,EAAIL,QAAQyE,UACrC,IAEH,OACE,gCACE,uBACEpE,IAAKA,EACLS,KAAK,OACL7E,UAAU,6BACVyI,OAAO,OACPnD,SAAUA,IAEZ,wBAAQtF,UAAU,MAAMC,QAASA,EAASH,SAAUA,EAApD,6BC3CO4I,GAAuD,SAAC,GAAD,IAC/DC,EAD+D,2BAGlE,+CAASA,GAAT,aACE,sBAAK3I,UAAU,4DAAf,UACE,kCACI,IACF,mBACE2G,KAAK,oDACL7C,OAAO,SACP8C,IAAI,WAHN,4BAMK,IARP,gOAcA,oBAAG5G,UAAU,OAAb,6DACmD,IACjD,mBAAG2G,KAAK,6BAA6B7C,OAAO,SAAS8C,IAAI,WAAzD,kBAEK,IAJP,uBAKuB,IACrB,mBAAGD,KAAK,2BAA2B7C,OAAO,SAAS8C,IAAI,WAAvD,kBAEK,IARP,0CAS0C,IACxC,mBACED,KAAK,+CACL7C,OAAO,SACP8C,IAAI,WAHN,wBAMK,IAhBP,+JAmByB,IACvB,mBACED,KAAK,yCACL7C,OAAO,SACP8C,IAAI,WAHN,oBAMK,IA1BP,qBCZOgC,GAAM,WACjB,OACE,sBAAK5I,UAAU,uEAAf,UACE,mBAAGA,UAAU,qBAAb,4BACA,cAAC,GAAD,CAAiBA,UAAU,iBAC3B,sBAAKA,UAAU,wEAAf,UACE,cAAC,GAAD,IACA,sBAAKA,UAAU,8BAAf,UACE,cAAC,GAAD,IACA,cAAC,EAAD,IACA,cAAC,GAAD,UAGJ,cAAC,EAAD,IACA,cAAC,EAAD,Q,OCjBN6I,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,GAAD,MAEFC,SAASC,eAAe,SAM1B5O,M","file":"static/js/main.9d1d5856.chunk.js","sourcesContent":["import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","export const clamp = (x: number, min: number, max: number) => {\n  return x < min ? min : x > max ? max : x;\n};\n\nexport const sleep = (delay: number) =>\n  new Promise((resolve) => setTimeout(resolve, delay));\n\nexport const extractFilename = (path: string, strip_suffix = false) => {\n  const s = path.split(\"\\\\\");\n  let filename = s[s.length - 1];\n  if (strip_suffix) filename = filename.split(\".csv\")[0];\n  return filename;\n};\n","import { csv, csvParse, DSVRowArray, quantile } from \"d3\";\nimport create from \"zustand\";\nimport { wrap } from \"comlink\";\n// eslint-disable-next-line import/no-webpack-loader-syntax\nimport Worker from \"worker-loader!./wasm.worker.ts\";\nimport { TWorker } from \"./wasm.worker\";\nimport { clamp, extractFilename } from \"./utils\";\n\nconst worker = wrap<TWorker>(new Worker());\n\nexport enum DataState {\n  Empty,\n  SampleData,\n  SelectColumn,\n  CustomData,\n  Error,\n}\n\nexport enum CalcState {\n  Empty,\n  Loading,\n  Finished,\n}\n\nexport type TData = {\n  value: number;\n}[];\n\nexport const yValue = (o: TData[0]) => o.value;\n\nconst emptyCalc = {\n  lastWindowSize: undefined,\n  calcState: CalcState.Empty,\n  profile: undefined,\n  profileIdxs: undefined,\n  discords: [],\n  motifs: [],\n};\n\nconst emptyCsvData = {\n  filename: undefined,\n  csvData: undefined,\n  csvColumns: undefined,\n  selectedColumn: undefined,\n};\n\nexport type TStore = {\n  windowSize: number;\n  /** Last window size computed */\n  lastWindowSize?: number;\n  data?: TData;\n  nRows?: number;\n  dataState: DataState;\n  calcState: CalcState;\n  profile?: number[];\n  profileIdxs?: number[];\n  filename?: string;\n  csvData?: DSVRowArray;\n  csvColumns?: string[];\n  selectedColumn?: string;\n  setData: (data: TData) => void;\n  setWindowSize: (windowSize: number) => void;\n  selectColumn: (column: string) => void;\n  loadSampleData: () => void;\n  uploadData: (data: string, path?: string) => void;\n  calculate: () => void;\n  brushPosition: number;\n  nearestNeighbourPosition: number;\n  setBrushPosition: (x: number) => void;\n  /** If neighbour is not found `-1` is returned */\n  getNearestNeighbour: (idx: number) => number;\n  /**\n   * Quantile threshold for discords (anomalies)\n   * calculated using matrix profile values, higher\n   * values indicate possible discords.\n   */\n  discordThreshold: number;\n  /** Indexes of calculated discords */\n  discords: number[];\n  calculateDiscords: () => void;\n  /**\n   * Quantile threshold for motifs (common patterns)\n   * calculated using matrix profile values, smaller\n   * values indicate possible common patterns.\n   */\n  motifThreshold: number;\n  /** Indexes of calculated motifs */\n  motifs: number[];\n  calculateMotifs: () => void;\n};\n\nexport const useStore = create<TStore>((set, get) => ({\n  windowSize: 50,\n  dataState: DataState.Empty,\n  calcState: CalcState.Empty,\n  setData: (data) => set({ data }),\n  setWindowSize: (windowSize) => set({ windowSize }),\n  selectColumn: (column) => {\n    set(({ csvData }) => {\n      if (csvData === undefined) return { dataState: DataState.Error };\n      const data = csvData.map((row) => ({ value: +(row[column] ?? \"\") }));\n      return {\n        data,\n        nRows: data.length,\n        selectedColumn: column,\n        dataState: DataState.CustomData,\n      };\n    });\n  },\n  loadSampleData: async () => {\n    const data = await csv(\"accident_UK.csv\", (row: any) => ({\n      value: +row[\"Total_Accident\"],\n    }));\n    set({\n      data,\n      nRows: data.length,\n      dataState: DataState.SampleData,\n      ...emptyCalc,\n      ...emptyCsvData,\n    });\n  },\n  uploadData: (data, path) => {\n    const filename = path === undefined ? \"\" : extractFilename(path);\n    const csvData = csvParse(data);\n    const csvColumns = csvData.columns;\n    set({\n      filename,\n      csvData,\n      csvColumns,\n      data: undefined,\n      nRows: undefined,\n      dataState: DataState.SelectColumn,\n      selectedColumn: undefined,\n      ...emptyCalc,\n    });\n    get().selectColumn(csvColumns[0]);\n  },\n  calculate: async () => {\n    set({ calcState: CalcState.Loading });\n    const data = get().data;\n    if (data === undefined) return;\n    const windowSize = get().windowSize;\n    const x = Float32Array.from(data.map(yValue));\n    const { profileIdxs, profile } = await worker.calculate(x, windowSize);\n    set({\n      profileIdxs,\n      profile,\n      calcState: CalcState.Finished,\n      lastWindowSize: windowSize,\n    });\n    get().calculateDiscords();\n    get().calculateMotifs();\n  },\n  getNearestNeighbour: (idx) => {\n    const pIdxs = get().profileIdxs;\n    if (pIdxs === undefined) return -1;\n    return pIdxs[Math.round(idx)] ?? -1;\n  },\n  brushPosition: -1,\n  nearestNeighbourPosition: -1,\n  setBrushPosition: (x) => {\n    return set(({ getNearestNeighbour, nRows }) => {\n      const brushPosition = clamp(Math.floor(x), 0, (nRows ?? 1) - 1);\n      return {\n        brushPosition,\n        nearestNeighbourPosition: getNearestNeighbour(brushPosition),\n      };\n    });\n  },\n  discordThreshold: 0.99,\n  discords: [],\n  calculateDiscords: () => {\n    set(({ profile, discordThreshold }) => {\n      if (profile === undefined) return { discords: [] };\n      const th = quantile(profile, discordThreshold);\n      const discords =\n        th === undefined\n          ? []\n          : profile\n              .map((x, i) => [x, i])\n              .filter(([x]) => x >= th)\n              .map(([x, i]) => i);\n      return { discords };\n    });\n  },\n  motifThreshold: 0.01,\n  motifs: [],\n  calculateMotifs: () => {\n    set(({ profile, motifThreshold }) => {\n      if (profile === undefined) return { motifs: [] };\n      const th = quantile(profile, motifThreshold);\n      const motifs =\n        th === undefined\n          ? []\n          : profile\n              .map((x, i) => [x, i])\n              .filter(([x]) => x <= th)\n              .map(([x, i]) => i);\n      return { motifs };\n    });\n  },\n}));\n","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/wasm.worker.6b4c3841.worker.js\");\n}\n","import React, { useMemo } from \"react\";\nimport { CalcState, DataState, TStore, useStore } from \"../store\";\n\nconst selector = ({ loadSampleData, dataState, calcState }: TStore) => ({\n  loadSampleData,\n  dataState,\n  calcState,\n});\n\nexport const LoadSampleBtn: React.FC = () => {\n  const { loadSampleData, dataState, calcState } = useStore(selector);\n\n  const disabled = useMemo(() => {\n    return (\n      dataState === DataState.SampleData || calcState === CalcState.Loading\n    );\n  }, [calcState, dataState]);\n\n  return (\n    <button className=\"btn\" onClick={loadSampleData} disabled={disabled}>\n      Load sample\n    </button>\n  );\n};\n","import {\n  axisBottom,\n  axisLeft,\n  extent,\n  format,\n  line,\n  scaleLinear,\n  select,\n} from \"d3\";\nimport React, { CSSProperties, useCallback, useMemo, useRef } from \"react\";\nimport { TStore, useStore } from \"../store\";\nimport { Margins } from \"../types\";\n\ninterface Props {\n  /** Time series data */\n  y: number[];\n  /** Maximum length for the data (to align all plots) */\n  yLength?: number;\n  height: number;\n  width: number;\n  margins: Margins;\n  /** min-max index limits for the plot */\n  limits: number[] | null;\n  title?: string;\n  className: string;\n  showYAxis?: boolean;\n  /** If true, a brush is shown under the cursor on hover */\n  cursorBrush?: boolean;\n  /** Classname for the `cursorBrush` */\n  brushClassName?: string;\n  /** Classname for the a cursor that points the nearest element */\n  brushNearestClassName?: string;\n  /** Custom styles for the a cursor that points the nearest element */\n  brushNearestStyle?: CSSProperties;\n  /** Window size for `cursorBrush` */\n  windowSize?: number;\n}\n\nconst selector = ({\n  brushPosition,\n  setBrushPosition,\n  nearestNeighbourPosition,\n}: TStore) => ({\n  brushPosition,\n  setBrushPosition,\n  nearestNeighbourPosition,\n});\n\nconst formatNumber = format(\".2s\");\n\nexport const LinePlot: React.FC<Props> = ({\n  y,\n  yLength,\n  margins,\n  height,\n  width,\n  limits,\n  title,\n  className,\n  brushNearestStyle,\n  windowSize,\n  brushClassName,\n  brushNearestClassName,\n  showYAxis = true,\n  cursorBrush = false,\n  children,\n}) => {\n  const innerHeight = height - margins.top - margins.bottom;\n  const innerWidth = width - margins.left - margins.right;\n\n  const { x, yShow } = useMemo(() => {\n    return limits === null\n      ? { x: [0, yLength ?? y.length], yShow: y }\n      : { x: [limits[0], limits[1]], yShow: y.slice(limits[0], limits[1]) };\n  }, [limits, y, yLength]);\n\n  const { xAxis, xScale } = useMemo(() => {\n    const domain = x;\n    const range = [margins.left, width - margins.right];\n    const xScale = scaleLinear().domain(domain).range(range);\n    const xAxis = axisBottom(xScale).tickSize(5).tickSizeOuter(0);\n    return { xAxis, xScale };\n  }, [margins.left, margins.right, width, x]);\n\n  const { yAxis, yScale } = useMemo(() => {\n    const domain = extent(y).map((o?: number) => o ?? 0);\n    const range = [height - margins.bottom, margins.top];\n    const yScale = scaleLinear().domain(domain).range(range).nice();\n    const yAxis = axisLeft(yScale)\n      .tickSize(-innerWidth)\n      .tickPadding(5)\n      .ticks(4)\n      .tickFormat(formatNumber);\n\n    return { yScale, yAxis };\n  }, [y, height, margins, innerWidth]);\n\n  const path = useMemo(() => {\n    if (yShow !== undefined) {\n      return line()(yShow.map((o, i) => [xScale(i + x[0]), yScale(o)]));\n    }\n    return null;\n  }, [yShow, xScale, yScale, x]);\n\n  const xAxisRef = useCallback(\n    (node) => {\n      select(node).call(xAxis);\n    },\n    [xAxis]\n  );\n\n  const yAxisRef = useCallback(\n    (node) => {\n      if (showYAxis) select(node).transition().call(yAxis);\n    },\n    [showYAxis, yAxis]\n  );\n  const cursorRef = useRef<SVGRectElement>(null);\n\n  const scaleWindowSize = useMemo(\n    () =>\n      windowSize === 1 ? 1 : Math.abs(xScale(0) - xScale(windowSize ?? 0)),\n    [windowSize, xScale]\n  );\n\n  const {\n    brushPosition,\n    setBrushPosition,\n    nearestNeighbourPosition,\n  } = useStore(selector);\n\n  const { brushXPosition, brushWindowSize } = useMemo(() => {\n    const brushXPosition = xScale(brushPosition) - margins.left;\n    const brushWindowSize =\n      brushPosition === -1\n        ? 0\n        : Math.min(innerWidth - brushXPosition, scaleWindowSize);\n    return { brushXPosition, brushWindowSize };\n  }, [brushPosition, innerWidth, margins.left, scaleWindowSize, xScale]);\n\n  const { brushNearestXPosition, brushNearestWindowSize } = useMemo(() => {\n    const xPosition = xScale(nearestNeighbourPosition) - margins.left;\n    const brushNearestXPosition = Math.max(0, xPosition);\n    const leftCap = xPosition + scaleWindowSize;\n    const brushNearestWindowSize =\n      xPosition === -1 || leftCap < margins.left\n        ? 0\n        : Math.min(\n            leftCap,\n            scaleWindowSize,\n            innerWidth - brushNearestXPosition\n          );\n    return { brushNearestXPosition, brushNearestWindowSize };\n  }, [\n    innerWidth,\n    margins.left,\n    nearestNeighbourPosition,\n    scaleWindowSize,\n    xScale,\n  ]);\n\n  const onCursorMove = useCallback(\n    ({ clientX, target }) => {\n      const ref = cursorRef as React.RefObject<SVGRectElement>;\n      if (ref.current === null) return;\n      const { x } = target.getBoundingClientRect();\n      const newX = clientX - Math.round(x);\n      setBrushPosition(xScale.invert(newX + margins.left - 1));\n    },\n    [margins.left, setBrushPosition, xScale]\n  );\n\n  return (\n    <div className=\"bg-indigo-50 rounded-sm\">\n      <svg height={height} width={width}>\n        <rect\n          className=\"fill-current text-white\"\n          transform={`translate(${margins.left},${margins.top})`}\n          width={innerWidth}\n          height={innerHeight}\n        />\n        {title !== undefined ? (\n          <text\n            className=\"text-current text-2xl\"\n            transform={`translate(${margins.left + 5}, ${margins.top - 10})`}\n          >\n            {title}\n          </text>\n        ) : null}\n        <g\n          ref={xAxisRef}\n          transform={`translate(0,${height - margins.bottom})`}\n        />\n        <g ref={yAxisRef} transform={`translate(${margins.left},0)`} />\n        {path !== null ? (\n          <path fill=\"none\" className={className} d={path} />\n        ) : null}\n        <g transform={`translate(${margins.left},${margins.top})`}>\n          <rect\n            className={brushNearestClassName}\n            style={brushNearestStyle}\n            height={innerHeight}\n            x={brushNearestXPosition}\n            width={brushNearestWindowSize}\n          />\n          {cursorBrush ? (\n            <>\n              <rect\n                ref={cursorRef}\n                className={brushClassName}\n                height={innerHeight}\n                x={brushXPosition}\n                width={brushWindowSize}\n              />\n              <rect\n                className=\"opacity-0\"\n                width={innerWidth}\n                height={innerHeight}\n                onPointerMove={onCursorMove}\n              />\n            </>\n          ) : null}\n        </g>\n        {children}\n      </svg>\n    </div>\n  );\n};\n","import { extent, line, scaleLinear } from \"d3\";\nimport { brushX } from \"d3-brush\";\nimport { select } from \"d3-selection\";\nimport React, { useCallback, useEffect, useMemo, useRef } from \"react\";\nimport { Margins } from \"../types\";\nimport { LinePlot } from \"./LinePlot\";\n\ninterface Props {\n  y: number[];\n  profile?: number[];\n  width: number;\n  height: number;\n  margins: Margins;\n  windowSize?: number;\n  setLimits: (x: number[] | null) => void;\n}\n\nexport const Brush: React.FC<Props> = ({\n  y,\n  profile,\n  height,\n  width,\n  margins,\n  windowSize,\n  setLimits,\n}) => {\n  const xScale = useMemo(() => {\n    const domain = [0, y.length];\n    const range = [margins.left, width - margins.right];\n    const xScale = scaleLinear().domain(domain).range(range);\n    return xScale;\n  }, [y.length, margins.left, margins.right, width]);\n\n  const brushEnd = useCallback(\n    ({ selection, type }) => {\n      if (selection === null) {\n        setLimits(null);\n      } else if (type !== \"end\") {\n        setLimits(selection.map(xScale.invert));\n      }\n    },\n    [setLimits, xScale]\n  );\n\n  const brush = useMemo(() => {\n    const brush = brushX().extent([\n      [margins.left, margins.top],\n      [width - margins.right, height - margins.bottom],\n    ]);\n    brush.on(\"brush\", brushEnd);\n    brush.on(\"end\", brushEnd);\n    return brush;\n  }, [margins, width, height, brushEnd]);\n\n  const ref = useRef<SVGGElement>(null);\n\n  const yScaleMP = useMemo(() => {\n    const domain = extent(profile ?? [0, 100]).map((o?: number) => o ?? 0);\n    const range = [height - margins.bottom, margins.top];\n    const yScale = scaleLinear().domain(domain).range(range).nice();\n    return yScale;\n  }, [height, margins, profile]);\n\n  const pathMP = useMemo(() => {\n    if (profile !== undefined) {\n      return line()(profile.map((o, i) => [xScale(i), yScaleMP(o)]));\n    }\n    return null;\n  }, [profile, xScale, yScaleMP]);\n\n  useEffect(() => {\n    if (brush === undefined || ref.current === null) return;\n    select(ref.current).call(brush);\n  }, [brush, xScale, y.length, profile]);\n\n  return (\n    <div className=\"flex flex-col\">\n      <LinePlot\n        y={y}\n        margins={margins}\n        height={height}\n        width={width}\n        limits={null}\n        className=\"stroke-current text-blue-900 stroke-2 text-opacity-80\"\n        showYAxis={false}\n        windowSize={windowSize}\n        cursorBrush\n        brushClassName=\"fill-current text-blue-400 opacity-40\"\n        brushNearestClassName=\"fill-current text-blue-600 opacity-80 stroke-current stroke-2 stroke-dashed-8\"\n        brushNearestStyle={{ fillOpacity: 0.1 }}\n      >\n        {pathMP !== null ? (\n          <path\n            fill=\"none\"\n            className=\"stroke-current text-red-900 stroke-2 text-opacity-80\"\n            d={pathMP}\n          />\n        ) : null}\n        <g ref={ref} />\n      </LinePlot>\n    </div>\n  );\n};\n","import React, { ChangeEventHandler, useCallback } from \"react\";\nimport { TStore, useStore } from \"../store\";\n\nconst selector = ({ csvColumns, selectColumn }: TStore) => ({\n  csvColumns,\n  selectColumn,\n});\n\nexport const ColumnSelector: React.FC = () => {\n  const { csvColumns, selectColumn } = useStore(selector);\n\n  const onChange = useCallback<ChangeEventHandler<HTMLSelectElement>>(\n    ({ target }) => {\n      selectColumn(target.value);\n    },\n    [selectColumn]\n  );\n\n  return csvColumns !== undefined ? (\n    <div className=\"flex\">\n      <p className=\"font-medium\">Select column:</p>\n      <select\n        className=\"ml-2 py-0.5 rounded-md hover:shadow\"\n        onChange={onChange}\n      >\n        {csvColumns.map((col, i) => (\n          <option key={i} value={col}>\n            {col}\n          </option>\n        ))}\n      </select>\n    </div>\n  ) : null;\n};\n","import React, { useCallback, useMemo, useState } from \"react\";\nimport { CSVLink } from \"react-csv\";\nimport { CalcState, TStore, useStore } from \"../store\";\n\nconst selector = ({ profile, calcState, filename }: TStore) => ({\n  profile,\n  calcState,\n  filename,\n});\n\ninterface Props {\n  className?: string;\n}\n\nexport const DownloadCSV: React.FC<Props> = ({ className }) => {\n  const { profile, calcState, filename } = useStore(selector);\n  const [csv, setCsv] = useState<string>(\"\");\n  const disabled = useMemo(() => calcState === CalcState.Loading, [calcState]);\n  const downloadFilename = useMemo(() => {\n    if (filename === undefined) return \"matrix_profile.csv\";\n    return filename.split(\".csv\")[0] + \"_profile.csv\";\n  }, [filename]);\n\n  const onClick = useCallback(() => {\n    if (disabled) return false;\n    setCsv(\"matrix_profile\\n\" + (profile ?? []).join(\"\\n\"));\n    return true;\n  }, [disabled, profile]);\n\n  return (\n    <CSVLink\n      data={csv}\n      filename={downloadFilename}\n      onClick={onClick}\n      className={className}\n    >\n      <button className=\"btn text-base\" disabled={disabled}>\n        Download result\n      </button>\n    </CSVLink>\n  );\n};\n","import React, { useMemo, useState } from \"react\";\nimport useMeasure from \"react-use-measure\";\nimport { CalcState, DataState, TStore, useStore, yValue } from \"../store\";\nimport { clamp } from \"../utils\";\nimport { Brush } from \"./Brush\";\nimport { ColumnSelector } from \"./ColumnSelector\";\nimport { DownloadCSV } from \"./DownloadCSV\";\nimport { LinePlot } from \"./LinePlot\";\n\nconst selector = ({\n  data,\n  profile,\n  windowSize,\n  lastWindowSize,\n  dataState,\n  calcState,\n}: TStore) => ({\n  data,\n  profile,\n  windowSize,\n  lastWindowSize,\n  dataState,\n  calcState,\n});\n\nconst margins = {\n  left: 30,\n  right: 20,\n  top: 38,\n  bottom: 25,\n};\n\nconst brushMargins = {\n  ...margins,\n  top: 10,\n};\n\nconst plotLimits = { minHeight: 100, maxHeight: 200 };\nconst brushLimits = { minHeight: 50, maxHeight: 120 };\n\nexport const Plot = () => {\n  const [ref, { height, width }] = useMeasure({ polyfill: ResizeObserver });\n  const {\n    data,\n    profile,\n    windowSize,\n    lastWindowSize,\n    dataState,\n    calcState,\n  } = useStore(selector);\n  const [limits, setLimits] = useState<number[] | null>(null);\n  const plotData = useMemo(() => data?.map(yValue), [data]);\n  const { dataHeight, brushHeight } = useMemo(() => {\n    let dataHeight = profile === undefined ? height : height / 2;\n    dataHeight = clamp(dataHeight, plotLimits.minHeight, plotLimits.maxHeight);\n    const brushHeight = clamp(\n      height - dataHeight,\n      brushLimits.minHeight,\n      brushLimits.maxHeight\n    );\n    return { dataHeight, brushHeight };\n  }, [height, profile]);\n  const showWindowSize = useMemo(() => {\n    return calcState === CalcState.Empty\n      ? windowSize\n      : lastWindowSize ?? windowSize;\n  }, [calcState, lastWindowSize, windowSize]);\n\n  return (\n    <div ref={ref} style={{ minWidth: \"300px\" }} className=\"mt-4 flex flex-col\">\n      <ColumnSelector />\n      {plotData !== undefined ? (\n        <div className=\"mt-3\">\n          <LinePlot\n            y={plotData}\n            margins={margins}\n            height={dataHeight}\n            width={width}\n            limits={limits}\n            title=\"Time series data\"\n            className=\"stroke-current text-blue-900 stroke-2 text-opacity-80\"\n            cursorBrush\n            brushClassName=\"fill-current text-blue-400 opacity-40\"\n            brushNearestClassName=\"fill-current text-blue-600 opacity-80 stroke-current stroke-2 stroke-dashed-8\"\n            brushNearestStyle={{fillOpacity: 0.1}}\n            windowSize={showWindowSize}\n          />\n        </div>\n      ) : dataState === DataState.SelectColumn ? (\n        <div className=\"mt-5 text-center\">\n          <p>Select one column to plot.</p>\n        </div>\n      ) : (\n        <div className=\"mt-5 text-center\">\n          <p>Upload some time series data or Load the sample data.</p>\n        </div>\n      )}\n      {profile !== undefined ? (\n        <div className=\"mt-2\">\n          <LinePlot\n            y={profile}\n            yLength={plotData?.length}\n            margins={margins}\n            height={dataHeight}\n            width={width}\n            limits={limits}\n            title=\"Matrix profile\"\n            className=\"stroke-current text-red-900 stroke-2 text-opacity-80\"\n            cursorBrush\n            brushClassName=\"fill-current text-red-600 opacity-60 stroke-current stroke-2\"\n            brushNearestClassName=\"fill-none text-red-600 opacity-40 stroke-current stroke-2 stroke-dashed-8\"\n            windowSize={1}\n          />\n        </div>\n      ) : null}\n      {plotData !== undefined ? (\n        <div className=\"mt-2\">\n          <Brush\n            y={plotData}\n            profile={profile}\n            margins={brushMargins}\n            height={brushHeight}\n            width={width}\n            setLimits={setLimits}\n            windowSize={showWindowSize}\n          />\n        </div>\n      ) : null}\n      {profile !== undefined ? (\n        <DownloadCSV className=\"mt-2 ml-auto mr-2\" />\n      ) : plotData !== undefined ? (\n        <div className=\"mt-5 text-center\">\n          <p>Use the \"Calculate\" button to compute the matrix profile.</p>\n        </div>\n      ) : null}\n    </div>\n  );\n};\n","import { format } from \"d3-format\";\nimport React from \"react\";\nimport { DataState, TStore, useStore } from \"../store\";\n\nconst selector = ({ nRows, dataState, filename }: TStore) => ({\n  nRows,\n  dataState,\n  filename,\n});\n\nconst formatNumber = format(\",.2r\");\n\nexport const DataDescription: React.FC = () => {\n  const { nRows, dataState, filename } = useStore(selector);\n  const show =\n    dataState === DataState.SampleData || dataState === DataState.CustomData;\n  const fn = filename ?? \"custom_file\";\n\n  return show ? (\n    <div className=\"mt-4 text-base text-gray-700\">\n      <p className=\"inline font-medium\">Data: </p>\n      {dataState === DataState.CustomData ? (\n        <p className=\"inline\">\n          {fn}{\" \"}\n          {nRows !== undefined ? (\n            <span className=\"text-sm\">({formatNumber(nRows)} rows)</span>\n          ) : null}\n        </p>\n      ) : (\n        <>\n          <p className=\"inline\">\n            <a\n              href=\"https://www.kaggle.com/sadeghjalalian/road-accident-in-uk\"\n              target=\"_black\"\n              rel=\"noopener\"\n            >\n              Road Accident in UK\n            </a>\n          </p>\n          <p className=\"mt-1 font-light\">\n            This data provides detailed road safety data about the circumstances\n            of personal injury road accidents in GB from 2014 to 2017. The\n            statistics relate only to personal injury accidents on public roads\n            that are reported to the police, and subsequently recorded, using\n            the STATS19 accident reporting form.\n          </p>\n        </>\n      )}\n    </div>\n  ) : null;\n};\n","import React from \"react\";\n\nconst sizes = {\n  sm: \"h-3 w-3\",\n  md: \"h-4 w-4\",\n  lg: \"h-5 w-5\",\n};\n\ninterface Props {\n  className?: string;\n  size?: keyof typeof sizes;\n}\n\nexport const Spinner: React.FC<Props> = ({ className, size = \"md\" }) => {\n  const sz = sizes[size];\n\n  return (\n    <svg\n      className={`animate-spin ${sz} ${className}`}\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n};\n","import React, { useMemo } from \"react\";\nimport { CalcState, DataState, TStore, useStore } from \"../store\";\nimport { Spinner } from \"./Spinner\";\n\nconst selector = ({\n  dataState,\n  calcState,\n  windowSize,\n  lastWindowSize,\n  calculate,\n}: TStore) => ({\n  dataState,\n  calcState,\n  windowSize,\n  lastWindowSize,\n  calculate,\n});\n\nexport const CalculateBtn: React.FC = () => {\n  const {\n    dataState,\n    calcState,\n    windowSize,\n    lastWindowSize,\n    calculate,\n  } = useStore(selector);\n\n  const disabled = useMemo(() => {\n    const notWindowChanged = windowSize === (lastWindowSize ?? windowSize);\n    const stateReady =\n      dataState === DataState.Empty || calcState !== CalcState.Empty;\n    return notWindowChanged && stateReady;\n  }, [calcState, dataState, lastWindowSize, windowSize]);\n\n  return (\n    <button className=\"btn\" onClick={calculate} disabled={disabled}>\n      <div className=\"flex items-baseline\">\n        Calculate\n        {calcState === CalcState.Loading ? <Spinner className=\"ml-1\" /> : null}\n      </div>\n    </button>\n  );\n};\n","import React, { ChangeEventHandler, useCallback } from \"react\";\nimport { CalcState, TStore, useStore } from \"../store\";\n\nconst selector = ({ windowSize, calcState, setWindowSize }: TStore) => ({\n  windowSize,\n  calcState,\n  setWindowSize,\n});\n\nexport const WindowSizeSel: React.FC = () => {\n  const { windowSize, calcState, setWindowSize } = useStore(selector);\n  const onChange = useCallback<ChangeEventHandler<HTMLInputElement>>(\n    ({ target }) => setWindowSize(+target.value),\n    [setWindowSize]\n  );\n\n  return (\n    <div className=\"flex items-baseline\">\n      <p className=\"font-medium\">Window size:</p>\n      <input\n        type=\"number\"\n        min={0}\n        step={5}\n        disabled={calcState === CalcState.Loading}\n        defaultValue={windowSize}\n        onChange={onChange}\n        className=\"ml-2 w-20 md:w-28 py-0.5 rounded-md border focus:border-gray-600 hover:shadow text-center\"\n      />\n    </div>\n  );\n};\n","import React, { ChangeEventHandler, useCallback, useMemo, useRef } from \"react\";\nimport { CalcState, TStore, useStore } from \"../store\";\n\nconst selector = ({ calcState, uploadData }: TStore) => ({\n  calcState,\n  uploadData,\n});\n\nexport const UploadBtn: React.FC = () => {\n  const { calcState, uploadData } = useStore(selector);\n  const ref = useRef<HTMLInputElement>(null);\n  const disabled = useMemo(() => calcState === CalcState.Loading, [calcState]);\n\n  const reader = useMemo(() => {\n    const fr = new FileReader();\n    fr.onload = () => {\n      const path = ref.current?.value;\n      uploadData(fr.result as string, path);\n      if (ref.current !== null) ref.current.value = \"\";\n    };\n    return fr;\n  }, [uploadData]);\n\n  const onChange = useCallback<ChangeEventHandler<HTMLInputElement>>(\n    ({ target }) => {\n      if (target.files === null) return;\n      if (target.files[0] === undefined) return;\n      reader.readAsText(target.files[0]);\n    },\n    [reader]\n  );\n\n  const onClick = useCallback(() => {\n    if (ref.current !== null) ref.current.click();\n  }, []);\n\n  return (\n    <div>\n      <input\n        ref={ref}\n        type=\"file\"\n        className=\"hidden pointer-events-none\"\n        accept=\".csv\"\n        onChange={onChange}\n      />\n      <button className=\"btn\" onClick={onClick} disabled={disabled}>\n        Upload data\n      </button>\n    </div>\n  );\n};\n","import React, { HTMLProps } from \"react\";\n\nexport const RepoDescription: React.FC<HTMLProps<HTMLDivElement>> = ({\n  ...props\n}) => (\n  <div {...props}>\n    <div className=\"text-justify leading-snug font-light text-base sm:text-lg\">\n      <p>\n        A{\" \"}\n        <a\n          href=\"https://www.cs.ucr.edu/~eamonn/MatrixProfile.html\"\n          target=\"_black\"\n          rel=\"noopener\"\n        >\n          matrix profile\n        </a>{\" \"}\n        is a vector that contains the z-normalized euclidean distances between a\n        window of the time series and its nearest pair. This allow us to\n        identify potential anomalies (discords) and common patterns (motif) in\n        the data.\n      </p>\n      <p className=\"mt-2\">\n        To perform the matrix profile calculation I used{\" \"}\n        <a href=\"https://www.rust-lang.org/\" target=\"_black\" rel=\"noopener\">\n          Rust\n        </a>{\" \"}\n        and loaded here with{\" \"}\n        <a href=\"https://webassembly.org/\" target=\"_black\" rel=\"noopener\">\n          wasm\n        </a>{\" \"}\n        bindings, you can find the code in this{\" \"}\n        <a\n          href=\"https://github.com/renato145/matrix_profile/\"\n          target=\"_black\"\n          rel=\"noopener\"\n        >\n          repository\n        </a>{\" \"}\n        (atm I use a naive implementation, but plan to implement the STOMP\n        algorithm later). Also, if you would like to use matrix profile in\n        python I recommend the{\" \"}\n        <a\n          href=\"https://github.com/TDAmeritrade/stumpy\"\n          target=\"_black\"\n          rel=\"noopener\"\n        >\n          stumpy\n        </a>{\" \"}\n        library.\n      </p>\n    </div>\n  </div>\n);\n","import React from \"react\";\nimport { LoadSampleBtn } from \"./components/LoadSampleBtn\";\nimport { Plot } from \"./components/Plot\";\nimport { DataDescription } from \"./components/DataDescription\";\nimport { CalculateBtn } from \"./components/CalculateBtn\";\nimport { WindowSizeSel } from \"./components/WindowSizeSel\";\nimport { UploadBtn } from \"./components/UploadBtn\";\nimport { RepoDescription } from \"./components/RepoDescription\";\n\nexport const App = () => {\n  return (\n    <div className=\"flex flex-col container mx-auto px-4 md:px-10 pt-6 pb-2 min-h-screen\">\n      <p className=\"text-5xl font-bold\">Matrix Profile</p>\n      <RepoDescription className=\"mt-4 sm:mt-8\" />\n      <div className=\"mt-4 sm:mt-8 pr-4 flex flex-col sm:flex-row flex-wrap justify-between\">\n        <WindowSizeSel />\n        <div className=\"mt-3 sm:mt-0 flex space-x-2\">\n          <UploadBtn />\n          <LoadSampleBtn />\n          <CalculateBtn />\n        </div>\n      </div>\n      <DataDescription />\n      <Plot />\n    </div>\n  );\n};\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { App } from \"./App\";\nimport \"./index.css\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}