(this["webpackJsonpmatrix-profile-web"]=this["webpackJsonpmatrix-profile-web"]||[]).push([[0],{195:function(e,t,n){},196:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n.n(a),r=n(67),c=n.n(r),s=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,201)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),a(e),i(e),r(e),c(e)}))},o=n(2),l=n(6),u=n.n(l),d=n(10),m=n(44),b=n(4),h=n(73),f=n(69);var j,p,x=function(e,t,n){return e<t?t:e>n?n:e},v=Object(f.a)(new function(){return new Worker(n.p+"static/js/wasm.worker.6b4c3841.worker.js")});!function(e){e[e.Empty=0]="Empty",e[e.SampleData=1]="SampleData",e[e.SelectColumn=2]="SelectColumn",e[e.CustomData=3]="CustomData",e[e.Error=4]="Error"}(j||(j={})),function(e){e[e.Empty=0]="Empty",e[e.Loading=1]="Loading",e[e.Finished=2]="Finished"}(p||(p={}));var O=function(e){return e.value},w={lastWindowSize:void 0,calcState:p.Empty,profile:void 0,profileIdxs:void 0,discords:[],motifs:[]},g={filename:void 0,csvData:void 0,csvColumns:void 0,selectedColumn:void 0},S=Object(h.a)((function(e,t){return{windowSize:50,dataState:j.Empty,calcState:p.Empty,setData:function(t){return e({data:t})},setWindowSize:function(t){return e({windowSize:t})},selectColumn:function(t){e((function(e){var n=e.csvData;if(void 0===n)return{dataState:j.Error};var a=n.map((function(e){var n;return{value:+(null!==(n=e[t])&&void 0!==n?n:"")}}));return{data:a,nRows:a.length,selectedColumn:t,dataState:j.CustomData}}))},loadSampleData:function(){var t=Object(m.a)(u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(b.c)("accident_UK.csv",(function(e){return{value:+e.Total_Accident}}));case 2:n=t.sent,e(Object(d.a)(Object(d.a)({data:n,nRows:n.length,dataState:j.SampleData},w),g));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),uploadData:function(n,a){var i=void 0===a?"":function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.split("\\"),a=n[n.length-1];return t&&(a=a.split(".csv")[0]),a}(a),r=Object(b.d)(n),c=r.columns;e(Object(d.a)({filename:i,csvData:r,csvColumns:c,data:void 0,nRows:void 0,dataState:j.SelectColumn,selectedColumn:void 0},w)),t().selectColumn(c[0])},calculate:function(){var n=Object(m.a)(u.a.mark((function n(){var a,i,r,c,s,o;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e({calcState:p.Loading}),void 0!==(a=t().data)){n.next=4;break}return n.abrupt("return");case 4:return i=t().windowSize,r=Float32Array.from(a.map(O)),n.next=8,v.calculate(r,i);case 8:c=n.sent,s=c.profileIdxs,o=c.profile,e({profileIdxs:s,profile:o,calcState:p.Finished,lastWindowSize:i}),t().calculateDiscords(),t().calculateMotifs();case 14:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),getNearestNeighbour:function(e){var n,a=t().profileIdxs;return void 0===a?-1:null!==(n=a[Math.round(e)])&&void 0!==n?n:-1},brushPosition:-1,nearestNeighbourPosition:-1,setBrushPosition:function(t){return e((function(e){var n=e.getNearestNeighbour,a=e.nRows,i=x(Math.floor(t),0,(null!==a&&void 0!==a?a:1)-1);return{brushPosition:i,nearestNeighbourPosition:n(i)}}))},discordThreshold:.99,discords:[],calculateDiscords:function(){e((function(e){var t=e.profile,n=e.discordThreshold;if(void 0===t)return{discords:[]};var a=Object(b.h)(t,n);return{discords:void 0===a?[]:t.map((function(e,t){return[e,t]})).filter((function(e){return Object(o.a)(e,1)[0]>=a})).map((function(e){var t=Object(o.a)(e,2);t[0];return t[1]}))}}))},motifThreshold:.01,motifs:[],calculateMotifs:function(){e((function(e){var t=e.profile,n=e.motifThreshold;if(void 0===t)return{motifs:[]};var a=Object(b.h)(t,n);return{motifs:void 0===a?[]:t.map((function(e,t){return[e,t]})).filter((function(e){return Object(o.a)(e,1)[0]<=a})).map((function(e){var t=Object(o.a)(e,2);t[0];return t[1]}))}}))}}})),N=n(0),y=function(e){return{loadSampleData:e.loadSampleData,dataState:e.dataState,calcState:e.calcState}},k=function(){var e=S(y),t=e.loadSampleData,n=e.dataState,i=e.calcState,r=Object(a.useMemo)((function(){return n===j.SampleData||i===p.Loading}),[i,n]);return Object(N.jsx)("button",{className:"btn",onClick:t,disabled:r,children:"Load sample"})},C=n(75),z=n(36),M=n(60),D=function(e){return{brushPosition:e.brushPosition,setBrushPosition:e.setBrushPosition,nearestNeighbourPosition:e.nearestNeighbourPosition}},P=Object(b.f)(".2s"),W=function(e){var t=e.y,n=e.yLength,i=e.margins,r=e.height,c=e.width,s=e.limits,o=e.title,l=e.className,u=e.brushNearestStyle,d=e.windowSize,m=e.brushClassName,h=e.brushNearestClassName,f=e.showYAxis,j=void 0===f||f,p=e.cursorBrush,x=void 0!==p&&p,v=e.children,O=r-i.top-i.bottom,w=c-i.left-i.right,g=Object(a.useMemo)((function(){return null===s?{x:[0,null!==n&&void 0!==n?n:t.length],yShow:t}:{x:[s[0],s[1]],yShow:t.slice(s[0],s[1])}}),[s,t,n]),y=g.x,k=g.yShow,C=Object(a.useMemo)((function(){var e=y,t=[i.left,c-i.right],n=Object(b.i)().domain(e).range(t);return{xAxis:Object(b.a)(n).tickSize(5).tickSizeOuter(0),xScale:n}}),[i.left,i.right,c,y]),z=C.xAxis,M=C.xScale,W=Object(a.useMemo)((function(){var e=Object(b.e)(t).map((function(e){return null!==e&&void 0!==e?e:0})),n=[r-i.bottom,i.top],a=Object(b.i)().domain(e).range(n).nice();return{yScale:a,yAxis:Object(b.b)(a).tickSize(-w).tickPadding(5).ticks(4).tickFormat(P)}}),[t,r,i,w]),L=W.yAxis,T=W.yScale,A=Object(a.useMemo)((function(){return void 0!==k?Object(b.g)()(k.map((function(e,t){return[M(t+y[0]),T(e)]}))):null}),[k,M,T,y]),E=Object(a.useCallback)((function(e){Object(b.j)(e).call(z)}),[z]),R=Object(a.useCallback)((function(e){j&&Object(b.j)(e).transition().call(L)}),[j,L]),B=Object(a.useRef)(null),_=Object(a.useMemo)((function(){return 1===d?1:Math.abs(M(0)-M(null!==d&&void 0!==d?d:0))}),[d,M]),F=S(D),I=F.brushPosition,H=F.setBrushPosition,U=F.nearestNeighbourPosition,X=Object(a.useMemo)((function(){var e=M(I)-i.left;return{brushXPosition:e,brushWindowSize:-1===I?0:Math.min(w-e,_)}}),[I,w,i.left,_,M]),V=X.brushXPosition,J=X.brushWindowSize,K=Object(a.useMemo)((function(){var e=M(U)-i.left,t=Math.max(0,e),n=e+_;return{brushNearestXPosition:t,brushNearestWindowSize:-1===e||n<i.left?0:Math.min(n,_,w-t)}}),[w,i.left,U,_,M]),Y=K.brushNearestXPosition,q=K.brushNearestWindowSize,G=Object(a.useCallback)((function(e){var t=e.clientX,n=e.target;if(null!==B.current){var a=n.getBoundingClientRect().x,r=t-Math.round(a);H(M.invert(r+i.left-1))}}),[i.left,H,M]);return Object(N.jsx)("div",{className:"bg-indigo-50 rounded-sm",children:Object(N.jsxs)("svg",{height:r,width:c,children:[Object(N.jsx)("rect",{className:"fill-current text-white",transform:"translate(".concat(i.left,",").concat(i.top,")"),width:w,height:O}),void 0!==o?Object(N.jsx)("text",{className:"text-current text-2xl",transform:"translate(".concat(i.left+5,", ").concat(i.top-10,")"),children:o}):null,Object(N.jsx)("g",{ref:E,transform:"translate(0,".concat(r-i.bottom,")")}),Object(N.jsx)("g",{ref:R,transform:"translate(".concat(i.left,",0)")}),null!==A?Object(N.jsx)("path",{fill:"none",className:l,d:A}):null,Object(N.jsxs)("g",{transform:"translate(".concat(i.left,",").concat(i.top,")"),children:[Object(N.jsx)("rect",{className:h,style:u,height:O,x:Y,width:q}),x?Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)("rect",{ref:B,className:m,height:O,x:V,width:J}),Object(N.jsx)("rect",{className:"opacity-0",width:w,height:O,onPointerMove:G})]}):null]}),v]})})},L=function(e){var t=e.y,n=e.profile,i=e.height,r=e.width,c=e.margins,s=e.windowSize,o=e.setLimits,l=Object(a.useMemo)((function(){var e=[0,t.length],n=[c.left,r-c.right];return Object(b.i)().domain(e).range(n)}),[t.length,c.left,c.right,r]),u=Object(a.useCallback)((function(e){var t=e.selection,n=e.type;null===t?o(null):"end"!==n&&o(t.map(l.invert))}),[o,l]),d=Object(a.useMemo)((function(){var e=Object(z.a)().extent([[c.left,c.top],[r-c.right,i-c.bottom]]);return e.on("brush",u),e.on("end",u),e}),[c,r,i,u]),m=Object(a.useRef)(null),h=Object(a.useMemo)((function(){var e=Object(b.e)(null!==n&&void 0!==n?n:[0,100]).map((function(e){return null!==e&&void 0!==e?e:0})),t=[i-c.bottom,c.top];return Object(b.i)().domain(e).range(t).nice()}),[i,c,n]),f=Object(a.useMemo)((function(){return void 0!==n?Object(b.g)()(n.map((function(e,t){return[l(t),h(e)]}))):null}),[n,l,h]);return Object(a.useEffect)((function(){void 0!==d&&null!==m.current&&Object(M.a)(m.current).call(d)}),[d,l,t.length,n]),Object(N.jsx)("div",{className:"flex flex-col",children:Object(N.jsxs)(W,{y:t,margins:c,height:i,width:r,limits:null,className:"stroke-current text-blue-900 stroke-2 text-opacity-80",showYAxis:!1,windowSize:s,cursorBrush:!0,brushClassName:"fill-current text-blue-400 opacity-40",brushNearestClassName:"fill-current text-blue-600 opacity-80 stroke-current stroke-2 stroke-dashed-8",brushNearestStyle:{fillOpacity:.1},children:[null!==f?Object(N.jsx)("path",{fill:"none",className:"stroke-current text-red-900 stroke-2 text-opacity-80",d:f}):null,Object(N.jsx)("g",{ref:m})]})})},T=function(e){return{csvColumns:e.csvColumns,selectColumn:e.selectColumn}},A=function(){var e=S(T),t=e.csvColumns,n=e.selectColumn,i=Object(a.useCallback)((function(e){var t=e.target;n(t.value)}),[n]);return void 0!==t?Object(N.jsxs)("div",{className:"flex",children:[Object(N.jsx)("p",{className:"font-medium",children:"Select column:"}),Object(N.jsx)("select",{className:"ml-2 py-0.5 rounded-md hover:shadow",onChange:i,children:t.map((function(e,t){return Object(N.jsx)("option",{value:e,children:e},t)}))})]}):null},E=n(74),R=function(e){return{profile:e.profile,calcState:e.calcState,filename:e.filename}},B=function(e){var t=e.className,n=S(R),i=n.profile,r=n.calcState,c=n.filename,s=Object(a.useState)(""),l=Object(o.a)(s,2),u=l[0],d=l[1],m=Object(a.useMemo)((function(){return r===p.Loading}),[r]),b=Object(a.useMemo)((function(){return void 0===c?"matrix_profile.csv":c.split(".csv")[0]+"_profile.csv"}),[c]),h=Object(a.useCallback)((function(){return!m&&(d("matrix_profile\n"+(null!==i&&void 0!==i?i:[]).join("\n")),!0)}),[m,i]);return Object(N.jsx)(E.CSVLink,{data:u,filename:b,onClick:h,className:t,children:Object(N.jsx)("button",{className:"btn text-base",disabled:m,children:"Download result"})})},_=function(e){return{data:e.data,profile:e.profile,windowSize:e.windowSize,lastWindowSize:e.lastWindowSize,dataState:e.dataState,calcState:e.calcState}},F={left:30,right:20,top:38,bottom:25},I=Object(d.a)(Object(d.a)({},F),{},{top:10}),H=100,U=200,X=50,V=120,J=function(){var e=Object(C.a)({polyfill:ResizeObserver}),t=Object(o.a)(e,2),n=t[0],i=t[1],r=i.height,c=i.width,s=S(_),l=s.data,u=s.profile,d=s.windowSize,m=s.lastWindowSize,b=s.dataState,h=s.calcState,f=Object(a.useState)(null),v=Object(o.a)(f,2),w=v[0],g=v[1],y=Object(a.useMemo)((function(){return null===l||void 0===l?void 0:l.map(O)}),[l]),k=Object(a.useMemo)((function(){var e=void 0===u?r:r/2;return{dataHeight:e=x(e,H,U),brushHeight:x(r-e,X,V)}}),[r,u]),z=k.dataHeight,M=k.brushHeight,D=Object(a.useMemo)((function(){return h===p.Empty?d:null!==m&&void 0!==m?m:d}),[h,m,d]);return Object(N.jsxs)("div",{ref:n,style:{minWidth:"300px"},className:"mt-4 flex flex-col",children:[Object(N.jsx)(A,{}),void 0!==y?Object(N.jsx)("div",{className:"mt-3",children:Object(N.jsx)(W,{y:y,margins:F,height:z,width:c,limits:w,title:"Time series data",className:"stroke-current text-blue-900 stroke-2 text-opacity-80",cursorBrush:!0,brushClassName:"fill-current text-blue-400 opacity-40",brushNearestClassName:"fill-current text-blue-600 opacity-80 stroke-current stroke-2 stroke-dashed-8",brushNearestStyle:{fillOpacity:.1},windowSize:D})}):b===j.SelectColumn?Object(N.jsx)("div",{className:"mt-5 text-center",children:Object(N.jsx)("p",{children:"Select one column to plot."})}):Object(N.jsx)("div",{className:"mt-5 text-center",children:Object(N.jsx)("p",{children:"Upload some time series data or Load the sample data."})}),void 0!==u?Object(N.jsx)("div",{className:"mt-2",children:Object(N.jsx)(W,{y:u,yLength:null===y||void 0===y?void 0:y.length,margins:F,height:z,width:c,limits:w,title:"Matrix profile",className:"stroke-current text-red-900 stroke-2 text-opacity-80",cursorBrush:!0,brushClassName:"fill-current text-red-600 opacity-60 stroke-current stroke-2",brushNearestClassName:"fill-none text-red-600 opacity-40 stroke-current stroke-2 stroke-dashed-8",windowSize:1})}):null,void 0!==y?Object(N.jsx)("div",{className:"mt-2",children:Object(N.jsx)(L,{y:y,profile:u,margins:I,height:M,width:c,setLimits:g,windowSize:D})}):null,void 0!==u?Object(N.jsx)(B,{className:"mt-2 ml-auto mr-2"}):void 0!==y?Object(N.jsx)("div",{className:"mt-5 text-center",children:Object(N.jsx)("p",{children:'Use the "Calculate" button to compute the matrix profile.'})}):null]})},K=n(32),Y=function(e){return{nRows:e.nRows,dataState:e.dataState,filename:e.filename}},q=Object(K.a)(",.2r"),G=function(){var e=S(Y),t=e.nRows,n=e.dataState,a=e.filename,i=null!==a&&void 0!==a?a:"custom_file";return n===j.SampleData||n===j.CustomData?Object(N.jsxs)("div",{className:"mt-4 text-base text-gray-700",children:[Object(N.jsx)("p",{className:"inline font-medium",children:"Data: "}),n===j.CustomData?Object(N.jsxs)("p",{className:"inline",children:[i," ",void 0!==t?Object(N.jsxs)("span",{className:"text-sm",children:["(",q(t)," rows)"]}):null]}):Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)("p",{className:"inline",children:Object(N.jsx)("a",{href:"https://www.kaggle.com/sadeghjalalian/road-accident-in-uk",target:"_black",rel:"noopener",children:"Road Accident in UK"})}),Object(N.jsx)("p",{className:"mt-1 font-light",children:"This data provides detailed road safety data about the circumstances of personal injury road accidents in GB from 2014 to 2017. The statistics relate only to personal injury accidents on public roads that are reported to the police, and subsequently recorded, using the STATS19 accident reporting form."})]})]}):null},Q={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"},Z=function(e){var t=e.className,n=e.size,a=Q[void 0===n?"md":n];return Object(N.jsxs)("svg",{className:"animate-spin ".concat(a," ").concat(t),fill:"none",viewBox:"0 0 24 24",children:[Object(N.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),Object(N.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})},$=function(e){return{dataState:e.dataState,calcState:e.calcState,windowSize:e.windowSize,lastWindowSize:e.lastWindowSize,calculate:e.calculate}},ee=function(){var e=S($),t=e.dataState,n=e.calcState,i=e.windowSize,r=e.lastWindowSize,c=e.calculate,s=Object(a.useMemo)((function(){var e=i===(null!==r&&void 0!==r?r:i),a=t===j.Empty||n!==p.Empty;return e&&a}),[n,t,r,i]);return Object(N.jsx)("button",{className:"btn",onClick:c,disabled:s,children:Object(N.jsxs)("div",{className:"flex items-baseline",children:["Calculate",n===p.Loading?Object(N.jsx)(Z,{className:"ml-1"}):null]})})},te=function(e){return{windowSize:e.windowSize,calcState:e.calcState,setWindowSize:e.setWindowSize}},ne=function(){var e=S(te),t=e.windowSize,n=e.calcState,i=e.setWindowSize,r=Object(a.useCallback)((function(e){var t=e.target;return i(+t.value)}),[i]);return Object(N.jsxs)("div",{className:"flex items-baseline",children:[Object(N.jsx)("p",{className:"font-medium",children:"Window size:"}),Object(N.jsx)("input",{type:"number",min:0,step:5,disabled:n===p.Loading,defaultValue:t,onChange:r,className:"ml-2 w-20 md:w-28 py-0.5 rounded-md border focus:border-gray-600 hover:shadow text-center"})]})},ae=function(e){return{calcState:e.calcState,uploadData:e.uploadData}},ie=function(){var e=S(ae),t=e.calcState,n=e.uploadData,i=Object(a.useRef)(null),r=Object(a.useMemo)((function(){return t===p.Loading}),[t]),c=Object(a.useMemo)((function(){var e=new FileReader;return e.onload=function(){var t,a=null===(t=i.current)||void 0===t?void 0:t.value;n(e.result,a),null!==i.current&&(i.current.value="")},e}),[n]),s=Object(a.useCallback)((function(e){var t=e.target;null!==t.files&&void 0!==t.files[0]&&c.readAsText(t.files[0])}),[c]),o=Object(a.useCallback)((function(){null!==i.current&&i.current.click()}),[]);return Object(N.jsxs)("div",{children:[Object(N.jsx)("input",{ref:i,type:"file",className:"hidden pointer-events-none",accept:".csv",onChange:s}),Object(N.jsx)("button",{className:"btn",onClick:o,disabled:r,children:"Upload data"})]})},re=function(e){var t=Object.assign({},e);return Object(N.jsx)("div",Object(d.a)(Object(d.a)({},t),{},{children:Object(N.jsxs)("div",{className:"text-justify leading-snug font-light text-base sm:text-lg",children:[Object(N.jsxs)("p",{children:["A"," ",Object(N.jsx)("a",{href:"https://www.cs.ucr.edu/~eamonn/MatrixProfile.html",target:"_black",rel:"noopener",children:"matrix profile"})," ","is a vector that contains the z-normalized euclidean distances between a window of the time series and its nearest pair. This allow us to identify potential anomalies (discords) and common patterns (motif) in the data."]}),Object(N.jsxs)("p",{className:"mt-2",children:["To perform the matrix profile calculation I used"," ",Object(N.jsx)("a",{href:"https://www.rust-lang.org/",target:"_black",rel:"noopener",children:"Rust"})," ","and loaded here with"," ",Object(N.jsx)("a",{href:"https://webassembly.org/",target:"_black",rel:"noopener",children:"wasm"})," ","bindings, you can find the code in this"," ",Object(N.jsx)("a",{href:"https://github.com/renato145/matrix_profile/",target:"_black",rel:"noopener",children:"repository"})," ","(atm I use a naive implementation, but plan to implement the STOMP algorithm later). Also, if you would like to use matrix profile in python I recommend the"," ",Object(N.jsx)("a",{href:"https://github.com/TDAmeritrade/stumpy",target:"_black",rel:"noopener",children:"stumpy"})," ","library."]})]})}))},ce=function(){return Object(N.jsxs)("div",{className:"flex flex-col container mx-auto px-4 md:px-10 pt-6 pb-2 min-h-screen",children:[Object(N.jsx)("p",{className:"text-5xl font-bold",children:"Matrix Profile"}),Object(N.jsx)(re,{className:"mt-4 sm:mt-8"}),Object(N.jsxs)("div",{className:"mt-4 sm:mt-8 pr-4 flex flex-col sm:flex-row flex-wrap justify-between",children:[Object(N.jsx)(ne,{}),Object(N.jsxs)("div",{className:"mt-3 sm:mt-0 flex space-x-2",children:[Object(N.jsx)(ie,{}),Object(N.jsx)(k,{}),Object(N.jsx)(ee,{})]})]}),Object(N.jsx)(G,{}),Object(N.jsx)(J,{})]})};n(195);c.a.render(Object(N.jsx)(i.a.StrictMode,{children:Object(N.jsx)(ce,{})}),document.getElementById("root")),s()}},[[196,1,2]]]);
//# sourceMappingURL=main.9d1d5856.chunk.js.map